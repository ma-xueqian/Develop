import{cp as ue,dz as de,cq as d,cr as F,ct as _e,cu as n,cU as me,cx as _,cy as f,cz as t,cA as a,cB as s,cK as r,cJ as i,cv as z,dI as ve,e6 as fe,cF as k,cH as he,cC as ge,cD as ye,cV as $,cN as A,dg as be,cw as J,eg as we,eh as ke,cT as Q,cZ as $e,dh as Ce,ei as xe,ej as Z,cQ as Ve,cR as De}from"./index-5edadd4e.js";import{_ as Te}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-58f6d688.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-07c6a6ea.js";const Se="/ui/assets/hit-test-empty-4afe2647.png",Fe={class:"hit-test"},ze={class:"hit-test__main p-16"},Ae=["title"],Re={class:"hit-test-height"},Ie={class:"active-button primary"},Ne={class:"footer-content flex-between"},qe={key:0},Be={key:0},Ke={key:1,class:"ml-4"},He={class:"hit-test__operate p-24 pt-0"},Pe={class:"mb-16"},Me={class:"title mb-8"},Ue={class:"mb-4"},Le={class:"mb-4"},je={class:"mb-4"},Ee={class:"mb-16"},Je={class:"title mb-8"},Qe={class:"mb-16"},Ze={class:"title mb-8"},Ge={class:"text-right"},Oe={class:"operate-textarea flex"},We={class:"operate"},Xe={src:we,alt:""},Ye={src:ke,alt:""},et=ue({__name:"index",setup(tt){const G=de(),{meta:{activeMenu:R},params:{id:I}}=G,N=d(),q=d(),m=d(!1),v=d([]),B=d(""),p=d(""),C=d({similarity:.6,top_number:5,search_mode:"embedding"}),x=d(!0),c=d({}),g=d(!1),h=d(""),y=F(()=>!p.value),O=F(()=>R.includes("application")),W=F(()=>R.includes("dataset"));function X(e){e==="keywords"?c.value.similarity=0:c.value.similarity=.6}function K(e){e==="open"?(g.value=!0,c.value=Q.cloneDeep(C.value)):e==="close"&&(g.value=!1,C.value=Q.cloneDeep(c.value))}function Y(e){B.value=$e("views.paragraph.paragraphDetail"),q.value.open(e)}function H(e){!(e!=null&&e.ctrlKey)&&!(e!=null&&e.shiftKey)&&!(e!=null&&e.altKey)&&!(e!=null&&e.metaKey)?(e.preventDefault(),!y.value&&!m.value&&P()):ee(e)}const ee=e=>{const l=N.value.$el.querySelector(".el-textarea__inner"),u=l.selectionStart,b=l.selectionEnd;e.preventDefault(),p.value=p.value.slice(0,u)+`
`+p.value.slice(b),Ce(()=>{l.setSelectionRange(u+1,u+1)})};function P(){const e={query_text:p.value,...C.value};W.value?xe.getDatasetHitTest(I,e,m).then(l=>{v.value=l.data&&Z(l.data,"comprehensive_score",!0),h.value=p.value,p.value="",x.value=!1}):O.value&&Ve.getApplicationHitTest(I,e,m).then(l=>{v.value=l.data&&Z(l.data,"comprehensive_score",!0),h.value=p.value,p.value="",x.value=!1})}function te(e){if(e){const l=v.value.filter(u=>u.id===e.id)[0];l.content=e.content,l.title=e.title}else v.value=[],P()}return _e(()=>{}),(e,l)=>{const u=n("el-text"),b=n("AppAvatar"),M=n("el-empty"),ae=n("Document"),le=n("el-icon"),U=n("AppIcon"),oe=n("CardBox"),V=n("el-col"),L=n("el-row"),se=n("el-scrollbar"),ie=n("LayoutContainer"),w=n("el-button"),D=n("el-radio"),T=n("el-card"),ne=n("el-radio-group"),j=n("el-input-number"),ce=n("el-popover"),re=n("el-input"),pe=me("loading");return _(),f("div",Fe,[t(ie,null,{header:a(()=>[s("h4",null,[r(i(e.$t("views.application.hitTest.title"))+" ",1),t(u,{type:"info",class:"ml-4"},{default:a(()=>[r(i(e.$t("views.application.hitTest.text")),1)]),_:1})])]),default:a(()=>[z((_(),f("div",ze,[s("div",{class:"question-title flex align-center",style:ve({visibility:h.value?"visible":"hidden"})},[t(b,null,{default:a(()=>[...l[8]||(l[8]=[s("img",{src:fe,style:{width:"54%"},alt:""},null,-1)])]),_:1}),s("h4",{class:"break-all ellipsis-1 ml-8",style:{width:"66%"},title:h.value},i(h.value),9,Ae)],4),t(se,null,{default:a(()=>[s("div",Re,[x.value?(_(),k(M,{key:0,image:he(Se),description:e.$t("views.application.hitTest.emptyMessage1"),style:{"padding-top":"160px"},"image-size":125},null,8,["image","description"])):v.value.length==0?(_(),k(M,{key:1,description:e.$t("views.application.hitTest.emptyMessage2"),style:{"padding-top":"160px"},"image-size":125},null,8,["description"])):(_(),k(L,{key:2},{default:a(()=>[(_(!0),f(ge,null,ye(v.value,(o,E)=>(_(),k(V,{xs:24,sm:12,md:12,lg:8,xl:6,key:E,class:"p-8"},{default:a(()=>[t(oe,{shadow:"hover",title:o.title||"-",description:o.content,class:$(["document-card layout-bg layout-bg cursor",o.is_active?"":"disabled"]),showIcon:!1,onClick:S=>Y(o)},{icon:a(()=>[t(b,{class:"mr-12 avatar-light",size:22},{default:a(()=>[r(i(E+1+""),1)]),_:2},1024)]),footer:a(()=>[s("div",Ne,[t(u,null,{default:a(()=>[t(le,null,{default:a(()=>[t(ae)]),_:1}),r(" "+i(o==null?void 0:o.document_name),1)]),_:2},1024),o.trample_num||o.star_num?(_(),f("div",qe,[o.star_num?(_(),f("span",Be,[t(U,{iconName:"app-like-color"}),r(" "+i(o.star_num),1)])):A("",!0),o.trample_num?(_(),f("span",Ke,[t(U,{iconName:"app-oppose-color"}),r(" "+i(o.trample_num),1)])):A("",!0)])):A("",!0)])]),default:a(()=>{var S;return[s("div",Ie,i((S=o.similarity)==null?void 0:S.toFixed(3)),1)]}),_:2},1032,["title","description","class","onClick"])]),_:2},1024))),128))]),_:1}))])]),_:1})])),[[pe,m.value]]),t(Te,{ref_key:"ParagraphDialogRef",ref:q,title:B.value,onRefresh:te},null,8,["title"])]),_:1}),s("div",He,[t(ce,{visible:g.value,placement:"right-end",width:500,trigger:"click"},{reference:a(()=>[t(w,{icon:"Setting",class:"mb-8",onClick:l[0]||(l[0]=o=>K("open"))},{default:a(()=>[r(i(e.$t("common.paramSetting")),1)]),_:1})]),default:a(()=>[s("div",Pe,[s("div",Me,i(e.$t("views.application.applicationForm.dialog.selectSearchMode")),1),t(ne,{modelValue:c.value.search_mode,"onUpdate:modelValue":l[1]||(l[1]=o=>c.value.search_mode=o),class:"card__radio",onChange:X},{default:a(()=>[t(T,{shadow:"never",class:$(["mb-16",c.value.search_mode==="embedding"?"active":""])},{default:a(()=>[t(D,{value:"embedding",size:"large"},{default:a(()=>[s("p",Ue,i(e.$t("views.application.applicationForm.dialog.vectorSearch")),1),t(u,{type:"info"},{default:a(()=>[r(i(e.$t("views.application.applicationForm.dialog.vectorSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),t(T,{shadow:"never",class:$(["mb-16",c.value.search_mode==="keywords"?"active":""])},{default:a(()=>[t(D,{value:"keywords",size:"large"},{default:a(()=>[s("p",Le,i(e.$t("views.application.applicationForm.dialog.fullTextSearch")),1),t(u,{type:"info"},{default:a(()=>[r(i(e.$t("views.application.applicationForm.dialog.fullTextSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),t(T,{shadow:"never",class:$(["mb-16",c.value.search_mode==="blend"?"active":""])},{default:a(()=>[t(D,{value:"blend",size:"large"},{default:a(()=>[s("p",je,i(e.$t("views.application.applicationForm.dialog.hybridSearch")),1),t(u,{type:"info"},{default:a(()=>[r(i(e.$t("views.application.applicationForm.dialog.hybridSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])]),t(L,{gutter:20},{default:a(()=>[t(V,{span:12},{default:a(()=>[s("div",Ee,[s("div",Je,i(e.$t("views.application.applicationForm.dialog.similarityThreshold")),1),t(j,{modelValue:c.value.similarity,"onUpdate:modelValue":l[2]||(l[2]=o=>c.value.similarity=o),min:0,max:c.value.search_mode==="blend"?2:1,precision:3,step:.1,"value-on-clear":0,"controls-position":"right",class:"w-full"},null,8,["modelValue","max"])])]),_:1}),t(V,{span:12},{default:a(()=>[s("div",Qe,[s("div",Ze,i(e.$t("views.application.applicationForm.dialog.topReferences")),1),t(j,{modelValue:c.value.top_number,"onUpdate:modelValue":l[3]||(l[3]=o=>c.value.top_number=o),min:1,max:1e4,"controls-position":"right",class:"w-full"},null,8,["modelValue"])])]),_:1})]),_:1}),s("div",Ge,[t(w,{onClick:l[4]||(l[4]=o=>g.value=!1)},{default:a(()=>[r(i(e.$t("common.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:l[5]||(l[5]=o=>K("close"))},{default:a(()=>[r(i(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"]),s("div",Oe,[t(re,{ref_key:"quickInputRef",ref:N,modelValue:p.value,"onUpdate:modelValue":l[6]||(l[6]=o=>p.value=o),type:"textarea",placeholder:e.$t("common.inputPlaceholder"),autosize:{minRows:1,maxRows:8},onKeydown:l[7]||(l[7]=be(o=>H(o),["enter"]))},null,8,["modelValue","placeholder"]),s("div",We,[t(w,{text:"",class:"sent-button",disabled:y.value||m.value,onClick:H},{default:a(()=>[z(s("img",Xe,null,512),[[J,y.value||m.value]]),z(s("img",Ye,null,512),[[J,!y.value&&!m.value]])]),_:1},8,["disabled"])])])])])}}});const st=De(et,[["__scopeId","data-v-e6bcc38f"]]);export{st as default};
