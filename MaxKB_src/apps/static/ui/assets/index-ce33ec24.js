import{dX as J,dY as me,eE as ce,dZ as pe,cp as O,cq as p,cZ as U,d0 as K,ct as X,cu as i,cx as g,cF as k,cA as s,cB as r,cV as _e,cJ as C,cz as o,cE as q,cK as D,dj as H,cR as Y,cr as x,cy as z,cH as M,dE as ve,cN as B,dv as fe,dw as be,dx as ge,cC as Q,d3 as he,cU as Ae,cv as Z,cD as ye,c_ as Me}from"./index-5edadd4e.js";const L="/team/member",$e=()=>J(`${L}`),ke=m=>me(`${L}/_batch`,m),Ee=m=>ce(`${L}/${m}`),Ce=m=>J(`${L}/${m}`),Se=(m,G)=>pe(`${L}/${m}`,G),w={getTeamMember:$e,postCreatTeamMember:ke,delTeamMember:Ee,getMemberPermissions:Ce,putMemberPermissions:Se},Ne=["id"],Ve={class:"dialog-sub-title"},Ue={class:"dialog-footer"},Te=O({__name:"CreateMemberDialog",emits:["refresh"],setup(m,{expose:G,emit:_}){const $=_,v=p(!1),f=p({users:[]}),y=p(),d=p(!1),T=p({users:[{type:"array",required:!0,message:U("views.team.teamForm.form.userName.requiredMessage"),trigger:"change"}]});K(v,e=>{e||(f.value={users:[]},d.value=!1)});const P=()=>{v.value=!0},n=async e=>{e&&await e.validate((u,b)=>{if(u){d.value=!0;let S=f.value.users.map(N=>N.id);w.postCreatTeamMember(S).then(N=>{H(U("common.submitSuccess")),$("refresh",S),v.value=!1,d.value=!1}).catch(()=>{d.value=!1})}})};return X(()=>{}),G({open:P,close}),(e,u)=>{const b=i("tags-input"),S=i("el-form-item"),N=i("el-form"),V=i("el-button"),I=i("el-dialog");return g(),k(I,{modelValue:v.value,"onUpdate:modelValue":u[4]||(u[4]=a=>v.value=a),"close-on-press-escape":!1,"close-on-click-modal":!1,"destroy-on-close":!0,width:"600",class:"member-dialog"},{header:s(({titleId:a,titleClass:E})=>[r("h4",{id:a,class:_e(E)},C(e.$t("views.team.addMember")),11,Ne),r("div",Ve,C(e.$t("views.team.addSubTitle")),1)]),footer:s(()=>[r("span",Ue,[o(V,{onClick:u[2]||(u[2]=q(a=>v.value=!1,["prevent"]))},{default:s(()=>[D(C(e.$t("common.cancel")),1)]),_:1}),o(V,{type:"primary",onClick:u[3]||(u[3]=a=>n(y.value)),loading:d.value},{default:s(()=>[D(C(e.$t("common.add")),1)]),_:1},8,["loading"])])]),default:s(()=>[o(N,{ref_key:"addMemberFormRef",ref:y,model:f.value,"label-position":"top",rules:T.value,"require-asterisk-position":"right",onSubmit:u[1]||(u[1]=q(()=>{},["prevent"]))},{default:s(()=>[o(S,{label:e.$t("views.team.teamForm.form.userName.label"),prop:"users"},{default:s(()=>[o(b,{tags:f.value.users,"onUpdate:tags":u[0]||(u[0]=a=>f.value.users=a),placeholder:e.$t("views.team.teamForm.form.userName.placeholder")},null,8,["tags","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});const Ge=Y(Te,[["__scopeId","data-v-70f8d926"]]);var t=(m=>(m.MANAGE="MANAGE",m.USE="USE",m.DATASET="DATASET",m.APPLICATION="APPLICATION",m))(t||{});const Pe={class:"p-24 pt-0"},xe={class:"flex align-center"},De=["src"],Ie=O({__name:"PermissionSetting",props:{data:{type:Array,default:()=>[]},id:String,type:String,tableHeight:Number,manage:Boolean},emits:["update:data"],setup(m,{emit:G}){const _=m,$=x(()=>_.type===t.DATASET),v=x(()=>_.type===t.APPLICATION),f=p({[t.MANAGE]:x({get:()=>d.value.some(n=>n.operate[t.MANAGE]),set:n=>{n?d.value.map(e=>{e.operate[t.MANAGE]=!0,e.operate[t.USE]=!0}):d.value.map(e=>{e.operate[t.MANAGE]=!1})}}),[t.USE]:x({get:()=>d.value.some(n=>n.operate[t.USE]),set:n=>{n?d.value.map(e=>{e.operate[t.USE]=!0}):d.value.map(e=>{e.operate[t.USE]=!1,e.operate[t.MANAGE]=!1})}})}),y=p(""),d=x(()=>_.data.filter(n=>n.name.toLowerCase().includes(y.value.toLowerCase()))),T=p({[t.MANAGE]:x(()=>d.value.every(e=>!e.operate[t.MANAGE])?!1:!d.value.every(e=>e.operate[t.MANAGE])),[t.USE]:x(()=>d.value.every(e=>!e.operate[t.USE])?!1:!d.value.every(e=>e.operate[t.USE]))});function P(n,e,u){_.data.map(b=>{b.id===e.id&&(b.operate[n]=u,n===t.MANAGE&&u?b.operate[t.USE]=!0:n===t.USE&&!u&&(b.operate[t.MANAGE]=!1))})}return(n,e)=>{const u=i("el-input"),b=i("AppAvatar"),S=i("auto-tooltip"),N=i("el-table-column"),V=i("el-checkbox"),I=i("el-table");return g(),z(Q,null,[o(u,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),placeholder:n.$t("common.search"),"prefix-icon":"Search",class:"p-24 pt-0 pb-0 mb-16 mt-4",clearable:""},null,8,["modelValue","placeholder"]),r("div",Pe,[o(I,{data:d.value,"max-height":m.tableHeight},{default:s(()=>[o(N,{prop:"name",label:v.value?n.$t("views.application.applicationForm.form.appName.label"):n.$t("views.dataset.datasetForm.form.datasetName.label")},{default:s(({row:a})=>[r("div",xe,[v.value&&M(ve)(a==null?void 0:a.icon)?(g(),k(b,{key:0,style:{background:"none"},class:"mr-12",shape:"square",size:24},{default:s(()=>[r("img",{src:a==null?void 0:a.icon,alt:""},null,8,De)]),_:2},1024)):a!=null&&a.name&&v.value?(g(),k(b,{key:1,name:a==null?void 0:a.name,pinyinColor:"",shape:"square",size:24,class:"mr-12"},null,8,["name"])):B("",!0),a.icon==="1"&&$.value?(g(),k(b,{key:2,class:"mr-8 avatar-purple",shape:"square",size:24},{default:s(()=>[...e[3]||(e[3]=[r("img",{src:fe,style:{width:"58%"},alt:""},null,-1)])]),_:1})):a.icon==="2"&&$.value?(g(),k(b,{key:3,class:"mr-8 avatar-purple",shape:"square",size:24,style:{background:"none"}},{default:s(()=>[...e[4]||(e[4]=[r("img",{src:be,style:{width:"100%"},alt:""},null,-1)])]),_:1})):$.value?(g(),k(b,{key:4,class:"mr-8 avatar-blue",shape:"square",size:24},{default:s(()=>[...e[5]||(e[5]=[r("img",{src:ge,style:{width:"58%"},alt:""},null,-1)])]),_:1})):B("",!0),o(S,{content:a==null?void 0:a.name},{default:s(()=>[D(C(a==null?void 0:a.name),1)]),_:2},1032,["content"])])]),_:1},8,["label"]),o(N,{label:n.$t("views.team.setting.management"),align:"center",width:"100",fixed:"right"},{header:s(()=>[o(V,{disabled:_.manage,modelValue:f.value[M(t).MANAGE],"onUpdate:modelValue":e[1]||(e[1]=a=>f.value[M(t).MANAGE]=a),indeterminate:T.value[M(t).MANAGE],label:n.$t("views.team.setting.management")},null,8,["disabled","modelValue","indeterminate","label"])]),default:s(({row:a})=>[o(V,{disabled:_.manage,modelValue:a.operate[M(t).MANAGE],"onUpdate:modelValue":E=>a.operate[M(t).MANAGE]=E,onChange:E=>P(M(t).MANAGE,a,E)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),o(N,{label:n.$t("views.team.setting.check"),align:"center",width:"100",fixed:"right"},{header:s(()=>[o(V,{disabled:_.manage,modelValue:f.value[M(t).USE],"onUpdate:modelValue":e[2]||(e[2]=a=>f.value[M(t).USE]=a),indeterminate:T.value[M(t).USE],label:n.$t("views.team.setting.check")},null,8,["disabled","modelValue","indeterminate","label"])]),default:s(({row:a})=>[o(V,{disabled:_.manage,modelValue:a.operate[M(t).USE],"onUpdate:modelValue":E=>a.operate[M(t).USE]=E,onChange:E=>P(M(t).USE,a,E)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","max-height"])])],64)}}}),we={class:"team-manage flex main-calc-height"},Le={class:"team-member p-8 border-r"},Fe={class:"flex-between p-16"},qe={class:"team-member-input"},Be={class:"list-height-left"},He={class:"flex-between"},ze={class:"mr-8"},Oe={class:"cursor"},Re={class:"permission-setting flex"},je={class:"team-manage__table"},Ze={class:"p-24 pb-0 mb-4"},Je={class:"submit-button"},Ke=O({__name:"index",setup(m){const G=p(),_=p(!1),$=p(!1),v=p([]),f=p([]),y=p(""),d=p(""),T=p(""),P=p(t.DATASET),n=p(0),e=he([{label:U("views.dataset.title"),value:t.DATASET,data:[]},{label:U("views.application.title"),value:t.APPLICATION,data:[]}]);K(T,l=>{l?f.value=v.value.filter(c=>c.username.toLowerCase().includes(l.toLowerCase())):f.value=v.value});function u(l){return l==="manage"}function b(){$.value=!0;const l={team_member_permission_list:[]};e.map(c=>{c.data.map(h=>{l.team_member_permission_list.push({target_id:h.id,type:h.type,operate:h.operate})})}),w.putMemberPermissions(y.value,l).then(()=>{H(U("common.submitSuccess")),S(y.value)}).catch(()=>{$.value=!1})}function S(l){$.value=!0,w.getMemberPermissions(l).then(c=>{(!c.data||Object.keys(c.data).length>0)&&e.map(h=>{Object.keys(c.data).indexOf(h.value)!==-1&&(h.data=c.data[h.value])}),$.value=!1}).catch(()=>{$.value=!1})}function N(l){Me(`${U("views.team.delete.confirmTitle")}${l.username}?`,U("views.team.delete.confirmMessage"),{confirmButtonText:U("common.confirm"),confirmButtonClass:"danger"}).then(()=>{_.value=!0,w.delTeamMember(l.id).then(()=>{H(U("common.deleteSuccess")),a()}).catch(()=>{_.value=!1})}).catch(()=>{})}function V(l){y.value=l.id,d.value=l.type,S(l.id)}function I(){var l;(l=G.value)==null||l.open()}function a(l){_.value=!0,w.getTeamMember().then(c=>{v.value=c.data,f.value=c.data;const h=l&&v.value.find(F=>F.user_id===l)||null;y.value=h?h.id:v.value[0].id,d.value=h?h.type:v.value[0].type,S(y.value),_.value=!1}).catch(()=>{_.value=!1})}function E(l){a(l&&l[0])}return X(()=>{n.value=window.innerHeight-330,window.onresize=()=>(()=>{n.value=window.innerHeight-330})(),a()}),(l,c)=>{const h=i("AppIcon"),F=i("el-button"),W=i("el-input"),ee=i("el-tag"),ae=i("MoreFilled"),te=i("el-icon"),le=i("el-dropdown-item"),se=i("el-dropdown-menu"),ne=i("el-dropdown"),oe=i("common-list"),ie=i("el-scrollbar"),re=i("el-tab-pane"),ue=i("el-tabs"),de=i("LayoutContainer"),R=Ae("loading");return g(),k(de,{header:l.$t("views.team.title")},{default:s(()=>[r("div",we,[r("div",Le,[r("div",Fe,[r("h4",null,C(l.$t("views.team.member")),1),o(F,{type:"primary",link:"",onClick:I},{default:s(()=>[o(h,{iconName:"app-add-users",class:"add-user-icon"})]),_:1})]),r("div",qe,[o(W,{modelValue:T.value,"onUpdate:modelValue":c[0]||(c[0]=A=>T.value=A),placeholder:l.$t("views.team.searchBar.placeholder"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),r("div",Be,[o(ie,null,{default:s(()=>[Z((g(),k(oe,{data:f.value,class:"mt-8",onClick:V,"default-active":y.value},{default:s(({row:A})=>[r("div",He,[r("div",null,[r("span",ze,C(A.username),1),u(A.type)?(g(),k(ee,{key:0,class:"default-tag"},{default:s(()=>[D(C(l.$t("views.team.manage")),1)]),_:1})):B("",!0)]),r("div",{onClick:c[1]||(c[1]=q(()=>{},["stop"])),style:{"margin-top":"5px"}},[u(A.type)?B("",!0):(g(),k(ne,{key:0,trigger:"click"},{dropdown:s(()=>[o(se,null,{default:s(()=>[o(le,{onClick:q(j=>N(A),["prevent"])},{default:s(()=>[D(C(l.$t("views.team.delete.button")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:s(()=>[r("span",Oe,[o(te,{class:"rotate-90"},{default:s(()=>[o(ae)]),_:1})])]),_:2},1024))])])]),_:1},8,["data","default-active"])),[[R,_.value]])]),_:1})])]),Z((g(),z("div",Re,[r("div",je,[r("h4",Ze,C(l.$t("views.team.permissionSetting")),1),o(ue,{modelValue:P.value,"onUpdate:modelValue":c[2]||(c[2]=A=>P.value=A),class:"team-manage__tabs"},{default:s(()=>[(g(!0),z(Q,null,ye(e,(A,j)=>(g(),k(re,{key:A.value,label:A.label,name:A.value},{default:s(()=>[(g(),k(Ie,{key:j,data:A.data,type:A.value,tableHeight:n.value,manage:u(d.value)},null,8,["data","type","tableHeight","manage"]))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),r("div",Je,[o(F,{type:"primary",onClick:b},{default:s(()=>[D(C(l.$t("common.save")),1)]),_:1})])])),[[R,$.value]])]),o(Ge,{ref_key:"CreateMemberRef",ref:G,onRefresh:E},null,512)]),_:1},8,["header"])}}});const Ye=Y(Ke,[["__scopeId","data-v-b1831dbc"]]);export{Ye as default};
