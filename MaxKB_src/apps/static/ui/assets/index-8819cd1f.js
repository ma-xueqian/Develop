import{dX as J,eT as ve,cp as q,cq as r,cu as n,cx as u,cF as h,cA as a,cB as s,cz as l,cE as j,cK as D,cJ as p,d3 as _e,cZ as v,ct as me,cU as be,cy as L,cC as U,cD as Y,cN as fe,cv as ge,cH as he,dA as ye,ed as we,cR as $e}from"./index-5edadd4e.js";const B="/operate_log",ke=(y,c,i)=>J(`${B}/${y.current_page}/${y.page_size}`,c,i),Le=()=>J(`${B}/menu_operate_option/`,void 0,void 0),De=(y,c)=>{ve("log.xlsx",`${B}/export/`,y,void 0,c)},F={getOperateLog:ke,getMenuList:Le,exportOperateLog:De},Ve={class:"border border-r-4 mb-16",style:{"white-space":"pre-wrap",height:"400px"}},xe={class:"p-16"},Ce={class:"dialog-footer mt-16"},Oe=q({__name:"DetailDialog",setup(y,{expose:c}){const i=r(!1),V=r();return c({open:_=>{V.value=JSON.stringify(_.details,null,4),i.value=!0}}),(_,d)=>{const M=n("el-scrollbar"),w=n("el-button"),m=n("el-dialog");return u(),h(m,{title:_.$t("views.operateLog.table.opt.label"),modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=$=>i.value=$),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[s("span",Ce,[l(w,{onClick:d[0]||(d[0]=j($=>i.value=!1,["prevent"]))},{default:a(()=>[D(p(_.$t("views.operateLog.close")),1)]),_:1})])]),default:a(()=>[s("div",Ve,[l(M,null,{default:a(()=>[s("div",xe,p(V.value),1)]),_:1})])]),_:1},8,["title","modelValue"])}}}),Me={class:"p-24"},Ue={class:"flex-between"},Ye={style:{display:"flex"}},ze={class:"flex-between complex-search"},Ne={class:"filter"},Se={class:"form-item mb-16"},Fe={class:"text-right"},je={class:"text-ellipsis"},Be={key:0},He={key:1,style:{color:"red"}},Pe={class:"mr-4"},Re=q({__name:"index",setup(y){const c=r(!1),i=r([]),V=r(),O=r(!1),_=_e({current_page:1,page_size:20,total:0}),d=r(""),M=r([]),w=r(7),m=r("user"),$=r(""),k=r({start_time:"",end_time:""}),H=r(""),I=[{value:7,label:v("views.applicationOverview.monitor.pastDayOptions.past7Days")},{value:30,label:v("views.applicationOverview.monitor.pastDayOptions.past30Days")},{value:90,label:v("views.applicationOverview.monitor.pastDayOptions.past90Days")},{value:183,label:v("views.applicationOverview.monitor.pastDayOptions.past183Days")},{value:"other",label:v("views.applicationOverview.monitor.pastDayOptions.other")}],K=[{value:"user",label:v("views.operateLog.table.user.label")},{value:"status",label:v("views.operateLog.table.status.label")},{value:"ip_address",label:v("views.operateLog.table.ip_address.label")}],X=[{value:"200",label:v("views.operateLog.table.status.success")},{value:"500",label:v("views.operateLog.table.status.fail")}],P=r([]);function R(t){t==="clear"&&(i.value=[]),b(),c.value=!1}function Z(t){b()}function G(t){m.value=t,d.value&&b()}function E(t){t!=="other"&&(k.value.start_time=we(t),k.value.end_time="",b())}function Q(t){k.value.start_time=t[0],k.value.end_time=t[1],b()}function W(t){V.value.open(t)}function ee(){_.current_page=1,b()}function T(){let t={start_time:k.value.start_time,end_time:k.value.end_time};return d.value&&m.value!=="status"&&(t[m.value]=d.value),m.value==="status"&&(t.status=$.value),i.value.length>0&&(t.menu=JSON.stringify(i.value)),t}function b(){return F.getOperateLog(_,T(),O).then(t=>{M.value=t.data.records,_.total=t.data.total})}function te(){return F.getMenuList().then(t=>{t.data.filter((f,x,z)=>x===z.findIndex(N=>N.menu===f.menu)).forEach(f=>{P.value.push({label:f.menu_label,value:f.menu})})})}const le=()=>{F.exportOperateLog(T(),O)};return me(()=>{te(),E(w.value)}),(t,o)=>{const f=n("el-option"),x=n("el-select"),z=n("el-date-picker"),N=n("el-input"),C=n("el-button"),ae=n("Filter"),oe=n("el-icon"),ne=n("el-checkbox"),se=n("el-checkbox-group"),ie=n("el-scrollbar"),re=n("el-popover"),g=n("el-table-column"),ue=n("el-tooltip"),pe=n("app-table"),ce=n("LayoutContainer"),de=be("loading");return u(),h(ce,{header:t.$t("views.operateLog.title")},{default:a(()=>[s("div",Me,[s("div",Ue,[s("div",null,[l(x,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=e=>w.value=e),class:"mr-12",onChange:E,style:{width:"180px"}},{default:a(()=>[(u(),L(U,null,Y(I,e=>l(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),w.value==="other"?(u(),h(z,{key:0,modelValue:H.value,"onUpdate:modelValue":o[1]||(o[1]=e=>H.value=e),type:"daterange","start-placeholder":t.$t("views.applicationOverview.monitor.startDatePlaceholder"),"end-placeholder":t.$t("views.applicationOverview.monitor.endDatePlaceholder"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:Q},null,8,["modelValue","start-placeholder","end-placeholder"])):fe("",!0)]),s("div",Ye,[s("div",ze,[l(x,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=e=>m.value=e),class:"complex-search__left",onChange:G,style:{width:"120px"}},{default:a(()=>[(u(),L(U,null,Y(K,e=>l(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),m.value==="status"?(u(),h(x,{key:0,modelValue:$.value,"onUpdate:modelValue":o[3]||(o[3]=e=>$.value=e),onChange:Z,style:{width:"220px"},clearable:""},{default:a(()=>[(u(),L(U,null,Y(X,e=>l(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])):(u(),h(N,{key:1,modelValue:d.value,"onUpdate:modelValue":o[4]||(o[4]=e=>d.value=e),onChange:b,placeholder:t.$t("common.search"),"prefix-icon":"Search",style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"]))]),l(C,{onClick:le,style:{"margin-left":"10px"}},{default:a(()=>[D(p(t.$t("common.export")),1)]),_:1})])]),ge((u(),h(pe,{class:"mt-16",data:M.value,"pagination-config":_,onSizeChange:ee,onChangePage:b},{default:a(()=>[l(g,{prop:"menu",label:t.$t("views.operateLog.table.menu.label"),width:"160"},{header:a(()=>[s("div",null,[s("span",null,p(t.$t("views.operateLog.table.menu.label")),1),l(re,{width:200,trigger:"click",visible:c.value},{reference:a(()=>[l(C,{style:{"margin-top":"-2px"},type:i.value&&i.value.length>0?"primary":"",link:"",onClick:o[5]||(o[5]=e=>c.value=!c.value)},{default:a(()=>[l(oe,null,{default:a(()=>[l(ae)]),_:1})]),_:1},8,["type"])]),default:a(()=>[s("div",Ne,[s("div",Se,[s("div",{onClick:o[7]||(o[7]=j(()=>{},["stop"]))},[l(ie,{height:"300",style:{margin:"0 0 0 10px"}},{default:a(()=>[l(se,{modelValue:i.value,"onUpdate:modelValue":o[6]||(o[6]=e=>i.value=e),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(u(!0),L(U,null,Y(P.value,e=>(u(),h(ne,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),s("div",Fe,[l(C,{size:"small",onClick:o[8]||(o[8]=e=>R("clear"))},{default:a(()=>[D(p(t.$t("common.clear")),1)]),_:1}),l(C,{type:"primary",onClick:R,size:"small"},{default:a(()=>[D(p(t.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"]),l(g,{prop:"operate",label:t.$t("views.operateLog.table.operate.detail")},{default:a(({row:e})=>{var S;return[l(ue,{content:e.operate+((S=e.operation_object)!=null&&S.name?`【${e.operation_object.name}】`:""),effect:"dark",placement:"top"},{default:a(()=>{var A;return[s("span",je,p(e.operate+((A=e.operation_object)!=null&&A.name?`【${e.operation_object.name}】`:"")),1)]}),_:2},1032,["content"])]}),_:1},8,["label"]),l(g,{width:"120",prop:"user.username",label:t.$t("views.operateLog.table.user.label")},null,8,["label"]),l(g,{prop:"status",label:t.$t("views.operateLog.table.status.label"),width:"100"},{default:a(({row:e})=>[e.status===200?(u(),L("span",Be,p(t.$t("views.operateLog.table.status.success")),1)):(u(),L("span",He,p(t.$t("views.operateLog.table.status.fail")),1))]),_:1},8,["label"]),l(g,{prop:"ip_address",label:t.$t("views.operateLog.table.ip_address.label"),width:"160"},null,8,["label"]),l(g,{label:t.$t("views.operateLog.table.operateTime.label"),width:"180"},{default:a(({row:e})=>[D(p(he(ye)(e.create_time)),1)]),_:1},8,["label"]),l(g,{label:t.$t("common.operation"),width:"110",align:"left",fixed:"right"},{default:a(({row:e})=>[s("span",Pe,[l(C,{type:"primary",text:"",onClick:j(S=>W(e),["stop"]),class:"text-button"},{default:a(()=>[D(p(t.$t("views.operateLog.table.opt.label")),1)]),_:2},1032,["onClick"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[de,O.value]])]),l(Oe,{ref_key:"DetailDialogRef",ref:V},null,512)]),_:1},8,["header"])}}});const Te=$e(Re,[["__scopeId","data-v-cd3decd4"]]);export{Te as default};
