import{cp as _e,d1 as me,dz as fe,cq as _,d3 as ge,cZ as w,d0 as Ae,cu as s,cx as p,cF as m,cA as t,cB as v,cz as l,cE as I,cK as g,cJ as d,cy as q,cC as te,cD as ae,dv as Ue,dw as Le,dx as Te,cN as B,ek as le,ct as xe,cU as qe,cv as Fe,cV as re,cH as ce,ea as pe,dj as ee,c_ as ve,ep as Ne,cR as Ge}from"./index-5edadd4e.js";import{_ as He}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-58f6d688.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang-062a048b.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-07c6a6ea.js";const Qe={class:"flex align-center"},Ee={class:"dialog-footer"},Je=_e({__name:"SelectDocumentDialog",emits:["refresh"],setup(he,{expose:F,emit:O}){const{dataset:S,document:R}=me(),N=fe(),{params:{id:A,documentId:b}}=N,U=O,y=_(),u=_(!1),P=_(!1),f=_({dataset_id:"",document_id:""}),L=ge({dataset_id:[{required:!0,message:w("views.log.selectDatasetPlaceholder"),trigger:"change"}],document_id:[{required:!0,message:w("views.log.documentPlaceholder"),trigger:"change"}]}),T=_([]),$=_([]),c=_(!1),h=_([]);Ae(u,r=>{var o;r||(f.value={dataset_id:"",document_id:""},T.value=[],$.value=[],h.value=[],(o=y.value)==null||o.clearValidate())});function Z(r){f.value.document_id="",G(r)}function G(r){R.asyncGetAllDocument(r,P).then(o=>{var C;$.value=(C=o.data)==null?void 0:C.filter(M=>M.id!==b)})}function W(){S.asyncGetAllDataset(P).then(r=>{T.value=r.data})}const H=r=>{var o;h.value=r,W(),(o=y.value)==null||o.clearValidate(),u.value=!0},X=async r=>{r&&await r.validate((o,C)=>{o&&le.putMigrateMulParagraph(A,b,f.value.dataset_id,f.value.document_id,h.value,P).then(()=>{U("refresh"),u.value=!1})})};return F({open:H}),(r,o)=>{const C=s("AppAvatar"),M=s("el-option"),j=s("el-select"),Q=s("el-form-item"),z=s("el-form"),x=s("el-button"),E=s("el-dialog");return p(),m(E,{title:`${r.$t("views.log.selectDataset")}/${r.$t("common.fileUpload.document")}`,modelValue:u.value,"onUpdate:modelValue":o[5]||(o[5]=i=>u.value=i),width:"500","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[v("span",Ee,[l(x,{onClick:o[3]||(o[3]=I(i=>u.value=!1,["prevent"]))},{default:t(()=>[g(d(r.$t("common.cancel")),1)]),_:1}),l(x,{type:"primary",onClick:o[4]||(o[4]=i=>X(y.value)),loading:P.value},{default:t(()=>[g(d(r.$t("views.document.setting.migration")),1)]),_:1},8,["loading"])])]),default:t(()=>[l(z,{ref_key:"formRef",ref:y,model:f.value,"label-position":"top","require-asterisk-position":"right",rules:L,onSubmit:o[2]||(o[2]=I(()=>{},["prevent"]))},{default:t(()=>[l(Q,{label:r.$t("views.log.selectDataset"),prop:"dataset_id"},{default:t(()=>[l(j,{modelValue:f.value.dataset_id,"onUpdate:modelValue":o[0]||(o[0]=i=>f.value.dataset_id=i),filterable:"",placeholder:r.$t("views.log.selectDatasetPlaceholder"),loading:c.value,onChange:Z},{default:t(()=>[(p(!0),q(te,null,ae(T.value,i=>(p(),m(M,{key:i.id,label:i.name,value:i.id},{default:t(()=>[v("span",Qe,[!i.dataset_id&&i.type==="1"?(p(),m(C,{key:0,class:"mr-12 avatar-purple",shape:"square",size:24},{default:t(()=>[...o[6]||(o[6]=[v("img",{src:Ue,style:{width:"58%"},alt:""},null,-1)])]),_:1})):!i.dataset_id&&i.type==="2"?(p(),m(C,{key:1,class:"mr-12 avatar-purple",shape:"square",size:24,style:{background:"none"}},{default:t(()=>[...o[7]||(o[7]=[v("img",{src:Le,style:{width:"100%"},alt:""},null,-1)])]),_:1})):!i.dataset_id&&i.type==="0"?(p(),m(C,{key:2,class:"mr-12 avatar-blue",shape:"square",size:24},{default:t(()=>[...o[8]||(o[8]=[v("img",{src:Te,style:{width:"58%"},alt:""},null,-1)])]),_:1})):B("",!0),g(" "+d(i.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"]),l(Q,{label:r.$t("views.log.saveToDocument"),prop:"document_id"},{default:t(()=>[l(j,{modelValue:f.value.document_id,"onUpdate:modelValue":o[1]||(o[1]=i=>f.value.document_id=i),filterable:"",placeholder:r.$t("views.log.documentPlaceholder"),loading:c.value},{default:t(()=>[(p(!0),q(te,null,ae($.value,i=>(p(),m(M,{key:i.id,label:i.name,value:i.id},{default:t(()=>[g(d(i.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Ke={style:{width:"78%"}},Oe={style:{display:"inline-block"}},Ze={class:"break-all"},We={class:"header-button"},Xe={class:"document-detail__main p-16"},Ye={class:"flex-between p-8"},et={class:"document-detail-height"},tt={class:"footer-content flex-between"},at={class:"footer-content flex-between"},lt={key:0,class:"mul-operation border-t w-full"},nt={class:"ml-8"},ot=_e({__name:"index",setup(he){const{paragraph:F}=me(),O=fe(),{params:{id:S,documentId:R}}=O,N=_(),A=_(),b=_(!1),U=_(!1),y=_({}),u=_([]),P=_(""),f=_(""),L=_("title"),T=()=>{f.value=""},$=_(!1),c=_([]),h=ge({current_page:1,page_size:30,total:0});function Z(){u.value=u.value.filter(e=>!c.value.includes(e.id)),c.value=[],ee(w("views.document.tip.migrationSuccess"))}function G(e){e&&(c.value=[e.id]),N.value.open(c.value)}function W(){ve(`${w("views.document.delete.confirmTitle1")} ${c.value.length} ${w("views.document.delete.confirmTitle2")}`,w("views.paragraph.delete.confirmMessage"),{confirmButtonText:w("common.confirm"),confirmButtonClass:"danger"}).then(()=>{le.delMulParagraph(S,R,c.value,U).then(()=>{u.value=u.value.filter(e=>!c.value.includes(e.id)),c.value=[],ee(w("views.document.delete.successMessage"))})}).catch(()=>{})}function H(e){$.value=e,c.value=[]}function X(e){c.value.includes(e)?c.value.splice(c.value.indexOf(e),1):c.value.push(e)}function r(){h.current_page=1,u.value=[],z()}function o(e){const a={is_active:!e.is_active};F.asyncPutParagraph(S,R,e.id,a,U).then(D=>{const J=u.value.findIndex(V=>V.id===e.id);return u.value[J].is_active=!u.value[J].is_active,!0}).catch(()=>!1)}function C(e){ve(`${w("views.paragraph.delete.confirmTitle")} ${e.title||"-"} ?`,w("views.paragraph.delete.confirmMessage"),{confirmButtonText:w("common.confirm"),confirmButtonClass:"danger"}).then(()=>{F.asyncDelParagraph(S,R,e.id,b).then(()=>{const a=u.value.findIndex(D=>D.id===e.id);u.value.splice(a,1),ee(w("common.deleteSuccess"))})}).catch(()=>{})}function M(){P.value=w("views.paragraph.addParagraph"),A.value.open()}function j(e){P.value=w("views.paragraph.paragraphDetail"),A.value.open(e)}function Q(){b.value=!0,Ne.getDocumentDetail(S,R).then(e=>{y.value=e.data,b.value=!1}).catch(()=>{b.value=!1})}function z(){le.getParagraph(S,R,h,f.value&&{[L.value]:f.value},b).then(e=>{u.value=[...u.value,...e.data.records],h.total=e.data.total})}function x(e){if(e){const a=u.value.findIndex(D=>D.id===e.id);u.value.splice(a,1,e)}else h.current_page=1,u.value=[],z()}const E=_();function i(e){const a=[];e?a.push(e.id):c.value.map(D=>{D&&a.push(D)}),E.value.open(a,"paragraph")}return xe(()=>{Q(),z()}),(e,a)=>{const D=s("el-link"),J=s("el-text"),V=s("el-button"),ne=s("el-option"),we=s("el-select"),be=s("el-input"),ke=s("el-empty"),oe=s("CardBox"),ye=s("el-switch"),$e=s("MoreFilled"),se=s("el-icon"),Ce=s("Connection"),Y=s("el-dropdown-item"),De=s("AppIcon"),Ve=s("el-dropdown-menu"),Pe=s("el-dropdown"),Se=s("el-col"),Re=s("el-row"),Me=s("InfiniteScroll"),ze=s("el-scrollbar"),Be=s("LayoutContainer"),Ie=qe("loading");return p(),m(Be,{"back-to":"-1",class:"document-detail"},{header:t(()=>{var n,K;return[v("div",Ke,[v("h3",Oe,d((n=y.value)==null?void 0:n.name),1),((K=y.value)==null?void 0:K.type)==="1"?(p(),m(J,{key:0,type:"info"},{default:t(()=>{var k,ie;return[g("（"+d(e.$t("views.document.form.source_url.label"))+"：",1),l(D,{href:(ie=(k=y.value)==null?void 0:k.meta)==null?void 0:ie.source_url,target:"_blank"},{default:t(()=>{var ue,de;return[v("span",Ze,d((de=(ue=y.value)==null?void 0:ue.meta)==null?void 0:de.source_url),1)]}),_:1},8,["href"]),a[10]||(a[10]=g("） ",-1))]}),_:1})):B("",!0)]),v("div",We,[$.value===!1?(p(),m(V,{key:0,onClick:a[0]||(a[0]=k=>H(!0))},{default:t(()=>[g(d(e.$t("views.paragraph.setting.batchSelected")),1)]),_:1})):B("",!0),$.value===!0?(p(),m(V,{key:1,onClick:a[1]||(a[1]=k=>H(!1))},{default:t(()=>[g(d(e.$t("views.paragraph.setting.cancelSelected")),1)]),_:1})):B("",!0),$.value===!1?(p(),m(V,{key:2,onClick:M,type:"primary",disabled:b.value},{default:t(()=>[g(d(e.$t("views.paragraph.addParagraph")),1)]),_:1},8,["disabled"])):B("",!0)])]}),default:t(()=>[Fe((p(),q("div",Xe,[v("div",Ye,[v("span",null,d(h.total)+" "+d(e.$t("views.paragraph.paragraph_count")),1),l(be,{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=n=>f.value=n),placeholder:e.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:r,clearable:""},{prepend:t(()=>[l(we,{modelValue:L.value,"onUpdate:modelValue":a[2]||(a[2]=n=>L.value=n),placeholder:"Select",style:{width:"80px"},onChange:T},{default:t(()=>[l(ne,{label:e.$t("common.title"),value:"title"},null,8,["label"]),l(ne,{label:e.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),l(ze,null,{default:t(()=>[v("div",et,[u.value.length==0?(p(),m(ke,{key:0,description:e.$t("common.noData")},null,8,["description"])):(p(),m(Me,{key:1,size:u.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":a[7]||(a[7]=n=>h.current_page=n),onLoad:z,loading:b.value},{default:t(()=>[l(Re,null,{default:t(()=>[(p(!0),q(te,null,ae(u.value,(n,K)=>(p(),m(Se,{xs:24,sm:12,md:8,lg:6,xl:6,key:K,class:"p-8"},{default:t(()=>[$.value===!0?(p(),m(oe,{key:0,shadow:"hover",title:n.title||"-",description:n.content,class:re(["document-card cursor",c.value.includes(n.id)?"selected":""]),showIcon:!1,onClick:k=>X(n.id)},{footer:t(()=>[v("div",tt,[v("span",null,d(ce(pe)(n==null?void 0:n.content.length)||0)+" "+d(e.$t("views.paragraph.character_count")),1)])]),default:t(()=>[v("div",{class:"active-button",onClick:a[4]||(a[4]=I(()=>{},["stop"]))})]),_:2},1032,["title","description","class","onClick"])):(p(),m(oe,{key:1,shadow:"hover",title:n.title||"-",description:n.content,class:re(["document-card cursor",n.is_active?"":"disabled"]),showIcon:!1,onClick:k=>j(n)},{footer:t(()=>[v("div",at,[v("span",null,d(ce(pe)(n==null?void 0:n.content.length)||0)+" "+d(e.$t("views.paragraph.character_count")),1),v("span",{onClick:a[6]||(a[6]=I(()=>{},["stop"]))},[l(Pe,{trigger:"click"},{dropdown:t(()=>[l(Ve,null,{default:t(()=>[l(Y,{onClick:k=>i(n)},{default:t(()=>[l(se,null,{default:t(()=>[l(Ce)]),_:1}),g(" "+d(e.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"]),l(Y,{onClick:k=>G(n)},{default:t(()=>[l(De,{iconName:"app-migrate"}),g(" "+d(e.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),l(Y,{icon:"Delete",onClick:I(k=>C(n),["stop"])},{default:t(()=>[g(d(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[l(V,{text:""},{default:t(()=>[l(se,null,{default:t(()=>[l($e)]),_:1})]),_:1})]),_:2},1024)])])]),default:t(()=>[v("div",{class:"active-button",onClick:a[5]||(a[5]=I(()=>{},["stop"]))},[l(ye,{loading:b.value,modelValue:n.is_active,"onUpdate:modelValue":k=>n.is_active=k,"before-change":()=>o(n),size:"small"},null,8,["loading","modelValue","onUpdate:modelValue","before-change"])])]),_:2},1032,["title","description","class","onClick"]))]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"]))])]),_:1}),$.value===!0?(p(),q("div",lt,[l(V,{disabled:c.value.length===0,onClick:a[8]||(a[8]=n=>i())},{default:t(()=>[g(d(e.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),l(V,{disabled:c.value.length===0,onClick:a[9]||(a[9]=n=>G())},{default:t(()=>[g(d(e.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),l(V,{disabled:c.value.length===0,onClick:W},{default:t(()=>[g(d(e.$t("common.delete")),1)]),_:1},8,["disabled"]),v("span",nt,d(e.$t("views.document.selected"))+" "+d(c.value.length)+" "+d(e.$t("views.document.items")),1)])):B("",!0)])),[[Ie,h.current_page===1&&b.value||U.value]]),l(He,{ref_key:"ParagraphDialogRef",ref:A,title:P.value,onRefresh:x},null,8,["title"]),l(Je,{ref_key:"SelectDocumentDialogRef",ref:N,onRefresh:Z},null,512),l(je,{ref_key:"GenerateRelatedDialogRef",ref:E,onRefresh:x},null,512)]),_:1})}}});const rt=Ge(ot,[["__scopeId","data-v-ec933abd"]]);export{rt as default};
