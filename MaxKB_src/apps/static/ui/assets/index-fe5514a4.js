import{cp as T,dB as Z,d1 as q,cq as t,cZ as v,dK as D,cu as i,cU as M,cv as P,cx as S,cF as U,cA as a,cz as s,cB as d,cJ as f,cK as C,cH as b,cN as I,dQ as z,dj as K}from"./index-5edadd4e.js";const j={class:"mb-24"},x={class:"mb-24"},G={class:"mb-24"},H={class:"flex-between w-full"},J={class:"operate-container mt-12"},W=T({__name:"index",setup(Q){const k=Z(),{user:p}=q(),l=t({email:"",code:"",type:"reset_password"}),g=t(),F=t({email:[{required:!0,message:v("views.user.userForm.form.email.requiredMessage"),trigger:"blur"},{validator:(e,o,r)=>{!/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(o)&&o!=""?r(new Error(v("views.user.userForm.form.email.validatorEmail"))):r()},trigger:"blur"}],code:[{required:!0,message:v("views.login.verificationCode.placeholder")}]}),n=t(!1),u=t(!1),c=t(60),_=t(!1),A=()=>{var e;(e=g.value)==null||e.validate().then(()=>z.checkCode(l.value,_)).then(()=>k.push({name:"reset_password",params:l.value}))},E=()=>{var e;(e=g.value)==null||e.validateField("email",o=>{o&&z.sendEmit(l.value.email,"reset_password",_).then(()=>{K(v("views.login.verificationCode.successMessage")),u.value=!0,y()})})},y=()=>{c.value<=0?(u.value=!1,c.value=60):setTimeout(()=>{c.value--,y()},1e3)};return D(()=>{n.value=!0,p.asyncGetProfile().then(()=>{n.value=!1})}),(e,o)=>{const r=i("el-input"),h=i("el-form-item"),w=i("el-button"),B=i("el-form"),L=i("LoginContainer"),N=i("login-layout"),R=M("loading");return n.value?I("",!0):P((S(),U(N,{key:0},{default:a(()=>{var $,V;return[s(L,{subTitle:($=b(p).themeInfo)!=null&&$.slogan?(V=b(p).themeInfo)==null?void 0:V.slogan:e.$t("views.system.theme.defaultSlogan")},{default:a(()=>[d("h2",j,f(e.$t("views.login.forgotPassword")),1),s(B,{class:"register-form",ref_key:"resetPasswordFormRef",ref:g,model:l.value,rules:F.value},{default:a(()=>[d("div",x,[s(h,{prop:"email"},{default:a(()=>[s(r,{size:"large",class:"input-item",modelValue:l.value.email,"onUpdate:modelValue":o[0]||(o[0]=m=>l.value.email=m),placeholder:e.$t("views.user.userForm.form.email.placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),d("div",G,[s(h,{prop:"code"},{default:a(()=>[d("div",H,[s(r,{size:"large",class:"code-input",modelValue:l.value.code,"onUpdate:modelValue":o[1]||(o[1]=m=>l.value.code=m),placeholder:e.$t("views.login.verificationCode.placeholder")},null,8,["modelValue","placeholder"]),s(w,{disabled:u.value,size:"large",class:"send-email-button ml-12",onClick:E,loading:n.value},{default:a(()=>[C(f(u.value?`${e.$t("views.login.verificationCode.resend")}（${c.value}s）`:e.$t("views.login.verificationCode.getVerificationCode")),1)]),_:1},8,["disabled","loading"])])]),_:1})])]),_:1},8,["model","rules"]),s(w,{size:"large",type:"primary",class:"w-full",onClick:A},{default:a(()=>[C(f(e.$t("views.login.buttons.checkCode")),1)]),_:1}),d("div",J,[s(w,{class:"register",onClick:o[2]||(o[2]=m=>b(k).push("/login")),link:"",type:"primary",icon:"ArrowLeft"},{default:a(()=>[C(f(e.$t("views.login.buttons.backLogin")),1)]),_:1})])]),_:1},8,["subTitle"])]}),_:1})),[[R,n.value||_.value]])}}});export{W as default};
