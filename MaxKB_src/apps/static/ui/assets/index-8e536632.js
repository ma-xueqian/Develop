import{cp as Q,cq as k,d3 as F,cZ as i,ct as O,cu as d,cU as B,cx as g,cy as y,cz as a,cA as n,cv as j,cK as U,cJ as h,cB as C,dj as N,dX as re,dY as ce,dZ as ue,cF as D,cH as le,eS as pe,cC as X,cD as Y,cY as W,cN as q,cX as _e,cR as oe,d1 as me,dB as ge,cG as fe}from"./index-5edadd4e.js";import{a as M}from"./auth-setting-e9d11ceb.js";const he={class:"authentication-setting__main main-calc-height"},ve={class:"form-container p-24"},be={class:"text-right"},ye=Q({__name:"LDAP",setup(S){const e=k({id:"",auth_type:"LDAP",config_data:{ldap_server:"",base_dn:"",password:"",ou:"",ldap_filter:"",ldap_mapping:""},is_active:!0}),v=k(),_=k(!1),f=F({"config_data.ldap_server":[{required:!0,message:i("views.system.authentication.ldap.serverPlaceholder"),trigger:"blur"}],"config_data.base_dn":[{required:!0,message:i("views.system.authentication.ldap.bindDNPlaceholder"),trigger:"blur"}],"config_data.password":[{required:!0,message:i("views.user.userForm.form.password.requiredMessage"),trigger:"blur"}],"config_data.ou":[{required:!0,message:i("views.system.authentication.ldap.ouPlaceholder"),trigger:"blur"}],"config_data.ldap_filter":[{required:!0,message:i("views.system.authentication.ldap.ldap_filterPlaceholder"),trigger:"blur"}],"config_data.ldap_mapping":[{required:!0,message:i("views.system.authentication.ldap.ldap_mappingPlaceholder"),trigger:"blur"}]}),w=async(t,l)=>{t&&await t.validate((r,s)=>{r&&(l?M.postAuthSetting(e.value,_).then(V=>{N(i("views.system.testSuccess"))}):M.putAuthSetting(e.value.auth_type,e.value,_).then(V=>{N(i("common.saveSuccess"))}))})};function c(){M.getAuthSetting(e.value.auth_type,_).then(t=>{t.data&&JSON.stringify(t.data)!=="{}"&&(e.value=t.data,t.data.config_data.ldap_mapping&&(e.value.config_data.ldap_mapping=JSON.stringify(JSON.parse(t.data.config_data.ldap_mapping))))})}return O(()=>{c()}),(t,l)=>{const r=d("el-input"),s=d("el-form-item"),V=d("el-checkbox"),A=d("el-form"),P=d("el-button"),u=d("el-scrollbar"),m=B("loading");return g(),y("div",he,[a(u,null,{default:n(()=>[j((g(),y("div",ve,[a(A,{ref_key:"authFormRef",ref:v,rules:f,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[a(s,{label:t.$t("views.system.authentication.ldap.address"),prop:"config_data.ldap_server"},{default:n(()=>[a(r,{modelValue:e.value.config_data.ldap_server,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.config_data.ldap_server=o),placeholder:t.$t("views.system.authentication.ldap.serverPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.ldap.bindDN"),prop:"config_data.base_dn"},{default:n(()=>[a(r,{modelValue:e.value.config_data.base_dn,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.config_data.base_dn=o),placeholder:t.$t("views.system.authentication.ldap.bindDNPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.password"),prop:"config_data.password"},{default:n(()=>[a(r,{modelValue:e.value.config_data.password,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.config_data.password=o),placeholder:t.$t("views.user.userForm.form.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.ldap.ou"),prop:"config_data.ou"},{default:n(()=>[a(r,{modelValue:e.value.config_data.ou,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.config_data.ou=o),placeholder:t.$t("views.system.authentication.ldap.ouPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.ldap.ldap_filter"),prop:"config_data.ldap_filter"},{default:n(()=>[a(r,{modelValue:e.value.config_data.ldap_filter,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.config_data.ldap_filter=o),placeholder:t.$t("views.system.authentication.ldap.ldap_filterPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.ldap.ldap_mapping"),prop:"config_data.ldap_mapping"},{default:n(()=>[a(r,{modelValue:e.value.config_data.ldap_mapping,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.config_data.ldap_mapping=o),placeholder:'{"name":"name","email":"mail","username":"cn"}'},null,8,["modelValue"])]),_:1},8,["label"]),a(s,null,{default:n(()=>[a(V,{modelValue:e.value.is_active,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.is_active=o)},{default:n(()=>[U(h(t.$t("views.system.authentication.ldap.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",be,[a(P,{onClick:l[7]||(l[7]=o=>w(v.value,"test")),disabled:_.value},{default:n(()=>[U(h(t.$t("views.system.test")),1)]),_:1},8,["disabled"]),a(P,{onClick:l[8]||(l[8]=o=>w(v.value)),type:"primary",disabled:_.value},{default:n(()=>[U(h(t.$t("common.save")),1)]),_:1},8,["disabled"])])])),[[m,_.value]])]),_:1})])}}}),we={class:"authentication-setting__main main-calc-height"},Ve={class:"form-container p-24"},ke={class:"text-right"},$e=Q({__name:"CAS",setup(S){const e=k({id:"",auth_type:"CAS",config_data:{ldpUri:"",validateUrl:"",redirectUrl:""},is_active:!0}),v=k(),_=k(!1),f=F({"config_data.ldpUri":[{required:!0,message:i("views.system.authentication.cas.ldpUriPlaceholder"),trigger:"blur"}],"config_data.validateUrl":[{required:!0,message:i("views.system.authentication.cas.validateUrlPlaceholder"),trigger:"blur"}],"config_data.redirectUrl":[{required:!0,message:i("views.system.authentication.cas.redirectUrlPlaceholder"),trigger:"blur"}]}),w=async t=>{t&&await t.validate((l,r)=>{l&&M.putAuthSetting(e.value.auth_type,e.value,_).then(s=>{N(i("common.saveSuccess"))})})};function c(){M.getAuthSetting(e.value.auth_type,_).then(t=>{t.data&&JSON.stringify(t.data)!=="{}"&&(t.data.config_data.validateUrl||(t.data.config_data.validateUrl=t.data.config_data.ldpUri),e.value=t.data)})}return O(()=>{c()}),(t,l)=>{const r=d("el-input"),s=d("el-form-item"),V=d("el-checkbox"),A=d("el-form"),P=d("el-button"),u=d("el-scrollbar"),m=B("loading");return g(),y("div",we,[a(u,null,{default:n(()=>[j((g(),y("div",Ve,[a(A,{ref_key:"authFormRef",ref:v,rules:f,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[a(s,{label:t.$t("views.system.authentication.cas.ldpUri"),prop:"config_data.ldpUri"},{default:n(()=>[a(r,{modelValue:e.value.config_data.ldpUri,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.config_data.ldpUri=o),placeholder:t.$t("views.system.authentication.cas.ldpUriPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.cas.validateUrl"),prop:"config_data.validateUrl"},{default:n(()=>[a(r,{modelValue:e.value.config_data.validateUrl,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.config_data.validateUrl=o),placeholder:t.$t("views.system.authentication.cas.validateUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.cas.redirectUrl"),prop:"config_data.redirectUrl"},{default:n(()=>[a(r,{modelValue:e.value.config_data.redirectUrl,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.config_data.redirectUrl=o),placeholder:t.$t("views.system.authentication.cas.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,null,{default:n(()=>[a(V,{modelValue:e.value.is_active,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.is_active=o)},{default:n(()=>[U(h(t.$t("views.system.authentication.cas.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",ke,[a(P,{onClick:l[4]||(l[4]=o=>w(v.value)),type:"primary",disabled:_.value},{default:n(()=>[U(h(t.$t("common.save")),1)]),_:1},8,["disabled"])])])),[[m,_.value]])]),_:1})])}}}),Ue={class:"authentication-setting__main main-calc-height"},Ce={class:"form-container p-24"},Pe={class:"text-right"},Se=Q({__name:"OIDC",setup(S){const e=k({id:"",auth_type:"OIDC",config_data:{authEndpoint:"",tokenEndpoint:"",userInfoEndpoint:"",scope:"",state:"",clientId:"",clientSecret:"",fieldMapping:'{"username": "preferred_username", "email": "email"}',redirectUrl:""},is_active:!0}),v=k(),_=k(!1),f=F({"config_data.authEndpoint":[{required:!0,message:i("views.system.authentication.oidc.authEndpointPlaceholder"),trigger:"blur"}],"config_data.tokenEndpoint":[{required:!0,message:i("views.system.authentication.oidc.tokenEndpointPlaceholder"),trigger:"blur"}],"config_data.userInfoEndpoint":[{required:!0,message:i("views.system.authentication.oidc.userInfoEndpointPlaceholder"),trigger:"blur"}],"config_data.scope":[{required:!0,message:i("views.system.authentication.oidc.scopePlaceholder"),trigger:"blur"}],"config_data.clientId":[{required:!0,message:i("views.system.authentication.oidc.clientIdPlaceholder"),trigger:"blur"}],"config_data.clientSecret":[{required:!0,message:i("views.system.authentication.oidc.clientSecretPlaceholder"),trigger:"blur"}],"config_data.fieldMapping":[{required:!0,message:i("views.system.authentication.oauth2.filedMappingPlaceholder"),trigger:"blur"}],"config_data.redirectUrl":[{required:!0,message:i("views.system.authentication.oidc.redirectUrlPlaceholder"),trigger:"blur"}],"config_data.logoutEndpoint":[{required:!0,message:i("views.system.authentication.oidc.logoutEndpointPlaceholder"),trigger:"blur"}]}),w=async(t,l)=>{t&&await t.validate((r,s)=>{r&&M.putAuthSetting(e.value.auth_type,e.value,_).then(V=>{N(i("common.saveSuccess"))})})};function c(){M.getAuthSetting(e.value.auth_type,_).then(t=>{t.data&&JSON.stringify(t.data)!=="{}"&&(e.value=t.data,(e.value.config_data.fieldMapping===""||e.value.config_data.fieldMapping===void 0)&&(e.value.config_data.fieldMapping='{"username": "preferred_username", "email": "email"}'))})}return O(()=>{c()}),(t,l)=>{const r=d("el-input"),s=d("el-form-item"),V=d("el-checkbox"),A=d("el-form"),P=d("el-button"),u=d("el-scrollbar"),m=B("loading");return g(),y("div",Ue,[a(u,null,{default:n(()=>[j((g(),y("div",Ce,[a(A,{ref_key:"authFormRef",ref:v,rules:f,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[a(s,{label:t.$t("views.system.authentication.oidc.authEndpoint"),prop:"config_data.authEndpoint"},{default:n(()=>[a(r,{modelValue:e.value.config_data.authEndpoint,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.config_data.authEndpoint=o),placeholder:t.$t("views.system.authentication.oidc.authEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oidc.tokenEndpoint"),prop:"config_data.tokenEndpoint"},{default:n(()=>[a(r,{modelValue:e.value.config_data.tokenEndpoint,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.config_data.tokenEndpoint=o),placeholder:t.$t("views.system.authentication.oidc.tokenEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oidc.userInfoEndpoint"),prop:"config_data.userInfoEndpoint"},{default:n(()=>[a(r,{modelValue:e.value.config_data.userInfoEndpoint,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.config_data.userInfoEndpoint=o),placeholder:t.$t("views.system.authentication.oidc.userInfoEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:"Scope",prop:"config_data.scope"},{default:n(()=>[a(r,{modelValue:e.value.config_data.scope,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.config_data.scope=o),placeholder:"openid+profile+email "},null,8,["modelValue"])]),_:1}),a(s,{label:"State",prop:"config_data.state"},{default:n(()=>[a(r,{modelValue:e.value.config_data.state,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.config_data.state=o),placeholder:""},null,8,["modelValue"])]),_:1}),a(s,{label:t.$t("views.system.authentication.oidc.clientId"),prop:"config_data.clientId"},{default:n(()=>[a(r,{modelValue:e.value.config_data.clientId,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.config_data.clientId=o),placeholder:t.$t("views.system.authentication.oidc.clientIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oidc.clientSecret"),prop:"config_data.clientSecret"},{default:n(()=>[a(r,{modelValue:e.value.config_data.clientSecret,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.config_data.clientSecret=o),placeholder:t.$t("views.system.authentication.oidc.clientSecretPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oauth2.filedMapping"),prop:"config_data.fieldMapping"},{default:n(()=>[a(r,{modelValue:e.value.config_data.fieldMapping,"onUpdate:modelValue":l[7]||(l[7]=o=>e.value.config_data.fieldMapping=o),placeholder:t.$t("views.system.authentication.oauth2.filedMappingPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oidc.redirectUrl"),prop:"config_data.redirectUrl"},{default:n(()=>[a(r,{modelValue:e.value.config_data.redirectUrl,"onUpdate:modelValue":l[8]||(l[8]=o=>e.value.config_data.redirectUrl=o),placeholder:t.$t("views.system.authentication.oidc.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,null,{default:n(()=>[a(V,{modelValue:e.value.is_active,"onUpdate:modelValue":l[9]||(l[9]=o=>e.value.is_active=o)},{default:n(()=>[U(h(t.$t("views.system.authentication.oidc.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",Pe,[a(P,{onClick:l[10]||(l[10]=o=>w(v.value)),type:"primary",disabled:_.value},{default:n(()=>[U(h(t.$t("common.save")),1)]),_:1},8,["disabled"])])])),[[m,_.value]])]),_:1})])}}}),Ee="/ui/assets/logo_dingtalk-ba6ce262.svg",Ae="/ui/assets/logo_lark-040c9608.svg",Ie="/ui/assets/logo_slack-b00a59ed.svg",qe="/ui/assets/logo_wechat-work-74043648.svg",Re="/ui/assets/logo_wechat-8623e982.svg",x="/platform",De=S=>re(`${x}/source`,void 0,S),Me=(S,e)=>ce(`${x}/source`,S,void 0,e),Ne=(S,e)=>ue(`${x}/source`,S,void 0,e),L={getPlatformInfo:De,updateConfig:Me,validateConnection:Ne},Te={class:"flex align-center",style:{"margin-left":"-8px"}},Fe={class:"dialog-footer"},Qe=Q({__name:"EditModal",emits:["refresh"],setup(S,{expose:e,emit:v}){const _=k(!1),f=k(!1),w=k(),c=F({key:"",logoSrc:"",name:"",isActive:!1,isValid:!1,config:{}}),t=p=>({corp_id:"Corp ID",app_key:(c==null?void 0:c.key)!="lark"?"APP Key":"App ID",app_secret:"APP Secret",agent_id:"Agent ID",callback_url:i("views.application.applicationAccess.callback")})[p]||(p?p.charAt(0).toUpperCase()+p.slice(1):""),l=p=>{switch(p){case"app_key":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.appKeyPlaceholder"),trigger:["blur","change"]}];case"app_secret":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.appSecretPlaceholder"),trigger:["blur","change"]}];case"corp_id":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.corpIdPlaceholder"),trigger:["blur","change"]}];case"agent_id":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.agentIdPlaceholder"),trigger:["blur","change"]}];case"callback_url":return[{required:!0,message:i("views.application.applicationAccess.callbackTip"),trigger:["blur","change"]},{pattern:/^https?:\/\/.+/,message:i("views.system.authentication.scanTheQRCode.callbackWarning"),trigger:["blur","change"]}];default:return[]}};e({open:async p=>{var T;_.value=!0,f.value=!0,Object.assign(c,p);let $=window.location.origin;switch(p.key){case"wecom":c.config.app_key&&(c.config.agent_id=c.config.app_key,delete c.config.app_key),c.config.callback_url=`${$}/api/wecom`;break;case"dingtalk":c.config.agent_id&&(c.config.corp_id=c.config.agent_id,delete c.config.agent_id),c.config={corp_id:c.config.corp_id,app_key:c.config.app_key,app_secret:c.config.app_secret,callback_url:$},c.config.callback_url=`${$}/api/dingtalk`;break;case"lark":c.config.callback_url=`${$}/api/feishu`;break}(T=w.value)==null||T.clearValidate()}});const s=()=>{var p;(p=w.value)==null||p.validate($=>{$?o():W(i("views.system.authentication.scanTheQRCode.validateFailedTip"))})},V=()=>{var p;_.value=!1,(p=w.value)==null||p.clearValidate(),m("refresh")};function A(){L.validateConnection(c,f).then(p=>{p.data?N(i("views.system.authentication.scanTheQRCode.validateSuccess")):W(i("views.system.authentication.scanTheQRCode.validateFailed"))})}const P=new Set(["app_secret","client_secret","secret"]),u=p=>P.has(p),m=v;function o(){L.updateConfig(c,f).then(p=>{var $;N(i("common.saveSuccess")),m("refresh"),_.value=!1,($=w.value)==null||$.clearValidate()})}return(p,$)=>{const T=d("el-input"),Z=d("el-form-item"),J=d("el-button"),z=d("el-drawer");return g(),D(z,{modelValue:_.value,"onUpdate:modelValue":$[0]||($[0]=H=>_.value=H),size:"60%","append-to-body":!0,"destroy-on-close":!0,onClose:V},{header:n(()=>[C("div",Te,[C("h4",null,h(c.name+p.$t("views.system.authentication.scanTheQRCode.setting")),1)])]),footer:n(()=>[C("span",Fe,[a(J,{onClick:V},{default:n(()=>[U(h(p.$t("common.cancel")),1)]),_:1}),a(J,{onClick:A},{default:n(()=>[U(h(p.$t("views.system.authentication.scanTheQRCode.validate")),1)]),_:1}),a(J,{type:"primary",onClick:s},{default:n(()=>[U(h(p.$t("common.save")),1)]),_:1})])]),default:n(()=>[a(le(pe),{model:c.config,"label-width":"120px","label-position":"top","require-asterisk-position":"right",ref_key:"formRef",ref:w},{default:n(()=>[(g(!0),y(X,null,Y(c.config,(H,I)=>(g(),D(Z,{key:I,label:t(I),prop:I,rules:l(I)},{default:n(()=>[a(T,{modelValue:c.config[I],"onUpdate:modelValue":G=>c.config[I]=G,type:u(I)?"password":"text","show-password":u(I)},null,8,["modelValue","onUpdate:modelValue","type","show-password"])]),_:2},1032,["label","prop","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Oe={class:"scan-height"},Je={class:"flex-between"},Le={class:"flex align-center"},Be=["src"],je={class:"ml-8"},ze={key:1},He={class:"mr-4"},Xe={key:0,class:"border-t mt-16"},Ye={class:"mt-4 mb-16 flex align-center"},Ze={key:0,class:"vertical-middle lighter break-all ellipsis-1"},Ge={key:1,class:"vertical-middle lighter break-all ellipsis-1"},Ke={key:2,class:"vertical-middle lighter break-all ellipsis-1"},We=Q({__name:"SCAN",setup(S){const e=k(),v=k(!1),_=F(w()),f=F({});O(()=>{l()});function w(){return[c("wecom",i("views.system.authentication.scanTheQRCode.wecom")),c("dingtalk",i("views.system.authentication.scanTheQRCode.dingtalk")),c("lark",i("views.system.authentication.scanTheQRCode.lark"))]}function c(u,m){let o="";switch(u){case"wecom":o="wechat-work";break;case"dingtalk":o="dingtalk";break;case"lark":o="lark";break;default:o="";break}const p={...u==="wecom"?{corp_id:"",agent_id:""}:{app_key:""},app_secret:"",callback_url:""};return{key:u,logoSrc:new URL(Object.assign({"../../../assets/logo_dingtalk.svg":Ee,"../../../assets/logo_lark.svg":Ae,"../../../assets/logo_slack.svg":Ie,"../../../assets/logo_wechat-work.svg":qe,"../../../assets/logo_wechat.svg":Re})[`../../../assets/logo_${o}.svg`],self.location).href,name:m,isActive:!1,isValid:!1,config:p}}function t(u,m){return{corp_id:"Corp ID",app_key:(m==null?void 0:m.key)!="lark"?"APP Key":"App ID",app_secret:"APP Secret",agent_id:"Agent ID",callback_url:i("views.application.applicationAccess.callback")}[u]||(u?u.charAt(0).toUpperCase()+u.slice(1):"")}function l(){v.value=!0,L.getPlatformInfo(v).then(u=>{u&&_.forEach(m=>{const o=u.data.find(p=>p.platform===m.key);if(o){if(Object.assign(m,{isValid:o.is_valid,isActive:o.is_active,config:o.config}),m.key==="dingtalk"){const{corp_id:p,app_key:$,app_secret:T}=m.config;m.config={corp_id:p,app_key:$,app_secret:T,callback_url:m.config.callback_url}}f[m.key]={},f[m.key].app_secret=!1}})})}function r(u){L.validateConnection(u,v).then(m=>{m.data?N(i("views.system.authentication.scanTheQRCode.validateSuccess")):W(i("views.system.authentication.scanTheQRCode.validateFailed"))})}function s(){l()}function V(u){L.updateConfig(u,v).then(m=>{N(i("common.saveSuccess"))})}function A(u){f[u]||(f[u]={}),f[u].app_secret=!f[u].app_secret}function P(u){var m;(m=e.value)==null||m.open(u)}return(u,m)=>{const o=d("el-tag"),p=d("el-button"),$=d("el-switch"),T=d("el-text"),Z=d("AppIcon"),J=d("Hide"),z=d("el-icon"),H=d("View"),I=d("el-col"),G=d("el-row"),ne=d("el-collapse-transition"),ie=d("el-card"),se=d("el-scrollbar"),de=B("loading");return j((g(),y("div",Oe,[a(se,null,{default:n(()=>[(g(!0),y(X,null,Y(_,b=>(g(),y("div",{key:b.key,class:"mb-16"},[a(ie,{class:"border-none mb-16",shadow:"none"},{default:n(()=>[C("div",Je,[C("div",Le,[C("img",{src:b.logoSrc,alt:"",width:"24px"},null,8,Be),C("h5",je,h(b.name),1),b.isValid?(g(),D(o,{key:0,type:"success",class:"ml-8"},{default:n(()=>[U(h(u.$t("views.system.authentication.scanTheQRCode.effective")),1)]),_:1})):q("",!0)]),C("div",null,[b.isValid?q("",!0):(g(),D(p,{key:0,type:"primary",onClick:R=>P(b)},{default:n(()=>[U(h(u.$t("views.system.authentication.scanTheQRCode.access")),1)]),_:2},1032,["onClick"])),b.isValid?(g(),y("span",ze,[C("span",He,h(b.isActive?u.$t("views.system.authentication.scanTheQRCode.alreadyTurnedOn"):u.$t("views.system.authentication.scanTheQRCode.notEnabled")),1),a($,{size:"small",modelValue:b.isActive,"onUpdate:modelValue":R=>b.isActive=R,disabled:!b.isValid,onChange:R=>V(b)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):q("",!0)])]),a(ne,null,{default:n(()=>[b.isValid?(g(),y("div",Xe,[a(G,{gutter:12,class:"mt-16"},{default:n(()=>[(g(!0),y(X,null,Y(b.config,(R,E)=>(g(),D(I,{key:E,span:12},{default:n(()=>{var ee,te;return[a(T,{type:"info"},{default:n(()=>[U(h(t(E,b)),1)]),_:2},1024),C("div",Ye,[E!=="app_secret"?(g(),y("span",Ze,h(R),1)):q("",!0),E==="app_secret"&&!((ee=f[b.key])!=null&&ee[E])?(g(),y("span",Ge,"************")):q("",!0),E==="app_secret"&&((te=f[b.key])!=null&&te[E])?(g(),y("span",Ke,h(R),1)):q("",!0),a(p,{type:"primary",text:"",onClick:()=>le(_e)(R)},{default:n(()=>[a(Z,{iconName:"app-copy"})]),_:2},1032,["onClick"]),E==="app_secret"?(g(),D(p,{key:3,type:"primary",text:"",onClick:K=>A(b.key)},{default:n(()=>{var K,ae;return[E==="app_secret"&&!((K=f[b.key])!=null&&K[E])?(g(),D(z,{key:0},{default:n(()=>[a(J)]),_:1})):q("",!0),E==="app_secret"&&((ae=f[b.key])!=null&&ae[E])?(g(),D(z,{key:1},{default:n(()=>[a(H)]),_:1})):q("",!0)]}),_:2},1032,["onClick"])):q("",!0)])]}),_:2},1024))),128))]),_:2},1024),a(p,{type:"primary",onClick:R=>P(b)},{default:n(()=>[U(h(u.$t("common.edit")),1)]),_:2},1032,["onClick"]),a(p,{onClick:R=>r(b)},{default:n(()=>[U(h(u.$t("views.system.authentication.scanTheQRCode.validate")),1)]),_:2},1032,["onClick"])])):q("",!0)]),_:2},1024)]),_:2},1024)]))),128)),a(Qe,{ref_key:"EditModelRef",ref:e,onRefresh:s},null,512)]),_:1})])),[[de,v.value]])}}});const xe=oe(We,[["__scopeId","data-v-001ab2e6"]]),et={class:"authentication-setting__main main-calc-height"},tt={class:"form-container p-24"},at={class:"text-right"},lt=Q({__name:"OAuth2",setup(S){const e=k({id:"",auth_type:"OAuth2",config_data:{authEndpoint:"",tokenEndpoint:"",userInfoEndpoint:"",scope:"",clientId:"",clientSecret:"",redirectUrl:"",fieldMapping:""},is_active:!0}),v=k(),_=k(!1),f=F({"config_data.authEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.authEndpointPlaceholder"),trigger:"blur"}],"config_data.tokenEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.tokenEndpointPlaceholder"),trigger:"blur"}],"config_data.userInfoEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.userInfoEndpointPlaceholder"),trigger:"blur"}],"config_data.scope":[{required:!0,message:i("views.system.authentication.oauth2.scopePlaceholder"),trigger:"blur"}],"config_data.clientId":[{required:!0,message:i("views.system.authentication.oauth2.clientIdPlaceholder"),trigger:"blur"}],"config_data.clientSecret":[{required:!0,message:i("views.system.authentication.oauth2.clientSecretPlaceholder"),trigger:"blur"}],"config_data.redirectUrl":[{required:!0,message:i("views.system.authentication.oauth2.redirectUrlPlaceholder"),trigger:"blur"}],"config_data.fieldMapping":[{required:!0,message:i("views.system.authentication.oauth2.filedMappingPlaceholder"),trigger:"blur"}]}),w=async(t,l)=>{t&&await t.validate((r,s)=>{r&&M.putAuthSetting(e.value.auth_type,e.value,_).then(V=>{N(i("common.saveSuccess"))})})};function c(){M.getAuthSetting(e.value.auth_type,_).then(t=>{t.data&&JSON.stringify(t.data)!=="{}"&&(e.value=t.data)})}return O(()=>{c()}),(t,l)=>{const r=d("el-input"),s=d("el-form-item"),V=d("el-checkbox"),A=d("el-form"),P=d("el-button"),u=d("el-scrollbar"),m=B("loading");return g(),y("div",et,[a(u,null,{default:n(()=>[j((g(),y("div",tt,[a(A,{ref_key:"authFormRef",ref:v,rules:f,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[a(s,{label:t.$t("views.system.authentication.oauth2.authEndpoint"),prop:"config_data.authEndpoint"},{default:n(()=>[a(r,{modelValue:e.value.config_data.authEndpoint,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.config_data.authEndpoint=o),placeholder:t.$t("views.system.authentication.oauth2.authEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oauth2.tokenEndpoint"),prop:"config_data.tokenEndpoint"},{default:n(()=>[a(r,{modelValue:e.value.config_data.tokenEndpoint,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.config_data.tokenEndpoint=o),placeholder:t.$t("views.system.authentication.oauth2.tokenEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oauth2.userInfoEndpoint"),prop:"config_data.userInfoEndpoint"},{default:n(()=>[a(r,{modelValue:e.value.config_data.userInfoEndpoint,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.config_data.userInfoEndpoint=o),placeholder:t.$t("views.system.authentication.oauth2.userInfoEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oauth2.scope"),prop:"config_data.scope"},{default:n(()=>[a(r,{modelValue:e.value.config_data.scope,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.config_data.scope=o),placeholder:t.$t("views.system.authentication.oauth2.scopePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oauth2.clientId"),prop:"config_data.clientId"},{default:n(()=>[a(r,{modelValue:e.value.config_data.clientId,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.config_data.clientId=o),placeholder:t.$t("views.system.authentication.oauth2.clientIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oauth2.clientSecret"),prop:"config_data.clientSecret"},{default:n(()=>[a(r,{modelValue:e.value.config_data.clientSecret,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.config_data.clientSecret=o),placeholder:t.$t("views.system.authentication.oauth2.clientSecretPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oauth2.redirectUrl"),prop:"config_data.redirectUrl"},{default:n(()=>[a(r,{modelValue:e.value.config_data.redirectUrl,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.config_data.redirectUrl=o),placeholder:t.$t("views.system.authentication.oauth2.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:t.$t("views.system.authentication.oauth2.filedMapping"),prop:"config_data.fieldMapping"},{default:n(()=>[a(r,{modelValue:e.value.config_data.fieldMapping,"onUpdate:modelValue":l[7]||(l[7]=o=>e.value.config_data.fieldMapping=o),placeholder:t.$t("views.system.authentication.oauth2.filedMappingPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,null,{default:n(()=>[a(V,{modelValue:e.value.is_active,"onUpdate:modelValue":l[8]||(l[8]=o=>e.value.is_active=o)},{default:n(()=>[U(h(t.$t("views.system.authentication.oauth2.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",at,[a(P,{onClick:l[9]||(l[9]=o=>w(v.value)),type:"primary",disabled:_.value},{default:n(()=>[U(h(t.$t("common.save")),1)]),_:1},8,["disabled"])])])),[[m,_.value]])]),_:1})])}}}),ot={class:"authentication-setting p-16-24"},nt=Q({__name:"index",setup(S){const{user:e}=me(),v=ge(),_=k("LDAP"),f=[{label:i("views.system.authentication.ldap.title"),name:"LDAP",component:ye},{label:i("views.system.authentication.cas.title"),name:"CAS",component:$e},{label:i("views.system.authentication.oidc.title"),name:"OIDC",component:Se},{label:i("views.system.authentication.oauth2.title"),name:"OAuth2",component:lt},{label:i("views.system.authentication.scanTheQRCode.title"),name:"SCAN",component:xe}];function w(){}return O(()=>{e.isExpire()&&v.push({path:"/application"})}),(c,t)=>{const l=d("el-tab-pane"),r=d("el-tabs");return g(),y("div",ot,[C("h4",null,h(c.$t("views.system.authentication.title")),1),a(r,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),class:"mt-4",onTabClick:w},{default:n(()=>[(g(),y(X,null,Y(f,(s,V)=>a(l,{key:V,label:s.label,name:s.name},{default:n(()=>[(g(),D(fe(s.component)))]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])])}}});const dt=oe(nt,[["__scopeId","data-v-719ed3c4"]]);export{dt as default};
