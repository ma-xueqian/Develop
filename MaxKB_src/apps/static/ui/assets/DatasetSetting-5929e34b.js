import{cp as J,dz as K,d1 as Z,cq as g,d3 as x,cZ as p,ct as O,cu as c,cU as Q,cx as d,cF as u,cA as l,cB as s,cz as o,cv as W,cy as A,cJ as v,ex as X,dx as Y,cK as b,cN as m,dv as j,dw as ee,cC as ae,cD as te,cH as le,dE as se,c_ as oe,ei as h,dj as F,cR as re}from"./index-5edadd4e.js";const ne={class:"dataset-setting main-calc-height"},de={class:"p-24"},ie={class:"title-decoration-1 mb-16"},ue={class:"flex align-center"},pe={class:"flex align-center"},ce={class:"flex align-center"},_e={key:0},ve={class:"title-decoration-1 mb-16"},me={class:"flex-between"},fe={class:"flex align-center"},ge=["src"],ye={class:"text-right"},he=J({__name:"DatasetSetting",setup(we){const I=K(),{params:{id:f}}=I,{dataset:T}=Z(),q=g(),$=g(),y=g(!1),n=g({}),B=g([]),S=g([]),C=g(""),r=g({source_url:"",selector:"",app_id:"",app_secret:"",folder_token:""}),z=x({source_url:[{required:!0,message:p("views.dataset.datasetForm.form.source_url.requiredMessage"),trigger:"blur"}],app_id:[{required:!0,message:p("views.application.applicationAccess.larkSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:p("views.application.applicationAccess.larkSetting.appSecretPlaceholder"),trigger:"blur"}],folder_token:[{required:!0,message:p("views.application.applicationAccess.larkSetting.folderTokenPlaceholder"),trigger:"blur"}]});async function R(){var a;await((a=$.value)==null?void 0:a.validate())&&await q.value.validate(t=>{if(t){const i=n.value.type==="1"||n.value.type==="2"?{application_id_list:S.value,meta:r.value,...$.value.form}:{application_id_list:S.value,...$.value.form};C.value!==$.value.form.embedding_mode_id?oe(p("common.tip"),p("views.dataset.tip.updateModeMessage"),{confirmButtonText:p("views.dataset.setting.vectorization")}).then(()=>{n.value.type==="2"?h.putLarkDataset(f,i,y).then(_=>{h.putReEmbeddingDataset(f).then(()=>{F(p("common.saveSuccess"))})}):h.putDataset(f,i,y).then(_=>{h.putReEmbeddingDataset(f).then(()=>{F(p("common.saveSuccess"))})})}).catch(()=>{}):n.value.type==="2"?h.putLarkDataset(f,i,y).then(_=>{F(p("common.saveSuccess"))}):h.putDataset(f,i,y).then(_=>{F(p("common.saveSuccess"))})}})}function M(){T.asyncGetDatasetDetail(f,y).then(a=>{var t,i;n.value=a.data,C.value=(t=a.data)==null?void 0:t.embedding_mode_id,(n.value.type==="1"||n.value.type==="2")&&(r.value=a.data.meta),S.value=(i=a.data)==null?void 0:i.application_id_list,h.listUsableApplication(f,y).then(_=>{B.value=_.data})})}return O(()=>{M()}),(a,t)=>{const i=c("AppAvatar"),_=c("el-text"),D=c("el-card"),w=c("el-form-item"),V=c("el-input"),U=c("el-form"),P=c("el-col"),L=c("el-row"),N=c("el-button"),E=c("el-scrollbar"),G=c("LayoutContainer"),H=Q("loading");return d(),u(G,{header:a.$t("common.setting")},{default:l(()=>[s("div",ne,[o(E,null,{default:l(()=>[W((d(),A("div",de,[s("h4",ie,v(a.$t("views.dataset.datasetForm.title.info")),1),o(X,{ref_key:"BaseFormRef",ref:$,data:n.value},null,8,["data"]),o(U,{ref_key:"webFormRef",ref:q,rules:z,model:r.value,"label-position":"top","require-asterisk-position":"right"},{default:l(()=>[o(w,{label:a.$t("views.dataset.datasetForm.form.datasetType.label"),required:""},{default:l(()=>{var e,k;return[n.value.type==="0"?(d(),u(D,{key:0,shadow:"never",class:"mb-8",style:{width:"50%"}},{default:l(()=>[s("div",ue,[o(i,{class:"mr-8 avatar-blue",shape:"square",size:32},{default:l(()=>[...t[7]||(t[7]=[s("img",{src:Y,style:{width:"58%"},alt:""},null,-1)])]),_:1}),s("div",null,[s("div",null,v(a.$t("views.dataset.general")),1),o(_,{type:"info"},{default:l(()=>[b(v(a.$t("views.dataset.datasetForm.form.datasetType.generalInfo")),1)]),_:1})])])]),_:1})):m("",!0),((e=n.value)==null?void 0:e.type)==="1"?(d(),u(D,{key:1,shadow:"never",class:"mb-8",style:{width:"50%"}},{default:l(()=>[s("div",pe,[o(i,{class:"mr-8 avatar-purple",shape:"square",size:32},{default:l(()=>[...t[8]||(t[8]=[s("img",{src:j,style:{width:"58%"},alt:""},null,-1)])]),_:1}),s("div",null,[s("div",null,v(a.$t("views.dataset.web")),1),o(_,{type:"info"},{default:l(()=>[b(v(a.$t("views.dataset.datasetForm.form.datasetType.webInfo")),1)]),_:1})])])]),_:1})):m("",!0),((k=n.value)==null?void 0:k.type)==="2"?(d(),u(D,{key:2,shadow:"never",class:"mb-8",style:{width:"50%"}},{default:l(()=>[s("div",ce,[o(i,{shape:"square",size:32,style:{background:"none"}},{default:l(()=>[...t[9]||(t[9]=[s("img",{src:ee,style:{width:"100%"},alt:""},null,-1)])]),_:1}),s("div",null,[s("p",null,[o(_,null,{default:l(()=>[b(v(a.$t("views.dataset.lark")),1)]),_:1})]),o(_,{type:"info"},{default:l(()=>[b(v(a.$t("views.dataset.datasetForm.form.datasetType.larkInfo")),1)]),_:1})])])]),_:1})):m("",!0)]}),_:1},8,["label"]),n.value.type==="1"?(d(),u(w,{key:0,label:a.$t("views.dataset.datasetForm.form.source_url.label"),prop:"source_url"},{default:l(()=>[o(V,{modelValue:r.value.source_url,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.source_url=e),placeholder:a.$t("views.dataset.datasetForm.form.source_url.placeholder"),onBlur:t[1]||(t[1]=e=>r.value.source_url=r.value.source_url.trim())},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):m("",!0),n.value.type==="1"?(d(),u(w,{key:1,label:a.$t("views.dataset.datasetForm.form.selector.label")},{default:l(()=>[o(V,{modelValue:r.value.selector,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.selector=e),placeholder:a.$t("views.dataset.datasetForm.form.selector.placeholder"),onBlur:t[3]||(t[3]=e=>r.value.selector=r.value.selector.trim())},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):m("",!0),n.value.type==="2"?(d(),u(w,{key:2,label:"App ID",prop:"app_id"},{default:l(()=>[o(V,{modelValue:r.value.app_id,"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.app_id=e),placeholder:a.$t("views.application.applicationAccess.larkSetting.appIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})):m("",!0),n.value.type==="2"?(d(),u(w,{key:3,label:"App Secret",prop:"app_id"},{default:l(()=>[o(V,{modelValue:r.value.app_secret,"onUpdate:modelValue":t[5]||(t[5]=e=>r.value.app_secret=e),type:"password","show-password":"",placeholder:a.$t("views.application.applicationAccess.larkSetting.appSecretPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})):m("",!0),n.value.type==="2"?(d(),u(w,{key:4,label:"Folder Token",prop:"folder_token"},{default:l(()=>[o(V,{modelValue:r.value.folder_token,"onUpdate:modelValue":t[6]||(t[6]=e=>r.value.folder_token=e),placeholder:a.$t("views.application.applicationAccess.larkSetting.folderTokenPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})):m("",!0)]),_:1},8,["rules","model"]),S.value.length>0?(d(),A("div",_e,[s("h4",ve,v(a.$t("views.dataset.relatedApplications")),1),o(L,{gutter:12},{default:l(()=>[(d(!0),A(ae,null,te(B.value.filter(e=>S.value.some(k=>k===(e==null?void 0:e.id))),(e,k)=>(d(),u(P,{span:12,key:k,class:"mb-16"},{default:l(()=>[o(D,{shadow:"never"},{default:l(()=>[s("div",me,[s("div",fe,[le(se)(e==null?void 0:e.icon)?(d(),u(i,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-12"},{default:l(()=>[s("img",{src:e==null?void 0:e.icon,alt:""},null,8,ge)]),_:2},1024)):e!=null&&e.name?(d(),u(i,{key:1,name:e==null?void 0:e.name,pinyinColor:"",shape:"square",size:32,class:"mr-12"},null,8,["name"])):m("",!0),b(" "+v(e.name),1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):m("",!0),s("div",ye,[o(N,{onClick:R,type:"primary"},{default:l(()=>[b(v(a.$t("common.save")),1)]),_:1})])])),[[H,y.value]])]),_:1})])]),_:1},8,["header"])}}});const be=re(he,[["__scopeId","data-v-4f7d1540"]]);export{be as default};
