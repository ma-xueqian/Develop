2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "django_migrations" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "app" varchar(255) NOT NULL, "name" varchar(255) NOT NULL, "applied" timestamp with time zone NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "user" ("id" uuid NOT NULL PRIMARY KEY, "email" varchar(254) NOT NULL UNIQUE, "phone" varchar(20) NOT NULL, "nick_name" varchar(150) NOT NULL, "username" varchar(150) NOT NULL UNIQUE, "password" varchar(150) NOT NULL, "role" varchar(150) NOT NULL, "is_active" boolean NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "user_email_54dc62b2_like" ON "user" ("email" varchar_pattern_ops); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "user_username_cf016618_like" ON "user" ("username" varchar_pattern_ops); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "team" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "user_id" uuid NOT NULL PRIMARY KEY, "name" varchar(128) NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "team_member" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "team_id" uuid NOT NULL, "user_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "team_member_permission" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "auth_target_type" varchar(128) NOT NULL, "target" uuid NOT NULL, "operate" varchar(256)[] NOT NULL, "member_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "model" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(128) NOT NULL, "model_type" varchar(128) NOT NULL, "model_name" varchar(128) NOT NULL, "provider" varchar(128) NOT NULL, "credential" varchar(5120) NOT NULL, "user_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "team" ADD CONSTRAINT "team_user_id_8d7fcd78_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "team_member" ADD CONSTRAINT "team_member_team_id_26812b86_fk_team_user_id" FOREIGN KEY ("team_id") REFERENCES "team" ("user_id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "team_member" ADD CONSTRAINT "team_member_user_id_9e3ae43b_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "team_member_team_id_26812b86" ON "team_member" ("team_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "team_member_user_id_9e3ae43b" ON "team_member" ("user_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "team_member_permission" ADD CONSTRAINT "team_member_permission_member_id_01dc944b_fk_team_member_id" FOREIGN KEY ("member_id") REFERENCES "team_member" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "team_member_permission_member_id_01dc944b" ON "team_member_permission" ("member_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ADD CONSTRAINT "model_name_user_id_158f66f7_uniq" UNIQUE ("name", "user_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ADD CONSTRAINT "model_user_id_a841bfc8_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "model_user_id_a841bfc8" ON "model" ("user_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "system_setting" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "type" integer NOT NULL PRIMARY KEY, "meta" jsonb NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ADD COLUMN "meta" jsonb DEFAULT '{}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ALTER COLUMN "meta" DROP DEFAULT; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ADD COLUMN "status" varchar(20) DEFAULT 'SUCCESS' NOT NULL; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ALTER COLUMN "status" DROP DEFAULT; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ALTER COLUMN "credential" TYPE varchar(102400); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ADD COLUMN "permission_type" varchar(20) DEFAULT 'PRIVATE' NOT NULL; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "model" ALTER COLUMN "permission_type" DROP DEFAULT; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "dataset" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(150) NOT NULL, "desc" varchar(256) NOT NULL, "type" varchar(1) NOT NULL, "meta" jsonb NOT NULL, "user_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "document" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(150) NOT NULL, "char_length" integer NOT NULL, "status" varchar(1) NOT NULL, "is_active" boolean NOT NULL, "type" varchar(1) NOT NULL, "meta" jsonb NOT NULL, "dataset_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "paragraph" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "content" varchar(4096) NOT NULL, "title" varchar(256) NOT NULL, "status" varchar(1) NOT NULL, "hit_num" integer NOT NULL, "is_active" boolean NOT NULL, "dataset_id" uuid NOT NULL, "document_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "problem" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "content" varchar(256) NOT NULL, "hit_num" integer NOT NULL, "dataset_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "problem_paragraph_mapping" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "dataset_id" uuid NOT NULL, "document_id" uuid NOT NULL, "paragraph_id" uuid NOT NULL, "problem_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "dataset" ADD CONSTRAINT "dataset_user_id_0938dbdc_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "dataset_user_id_0938dbdc" ON "dataset" ("user_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "document" ADD CONSTRAINT "document_dataset_id_12d355a7_fk_dataset_id" FOREIGN KEY ("dataset_id") REFERENCES "dataset" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "document_dataset_id_12d355a7" ON "document" ("dataset_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "paragraph" ADD CONSTRAINT "paragraph_dataset_id_a27ca31b_fk_dataset_id" FOREIGN KEY ("dataset_id") REFERENCES "dataset" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "paragraph_dataset_id_a27ca31b" ON "paragraph" ("dataset_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "paragraph_document_id_2e0722cc" ON "paragraph" ("document_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "problem_dataset_id_eb767585" ON "problem" ("dataset_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "problem_paragraph_mapping" ADD CONSTRAINT "problem_paragraph_mapping_document_id_74b9f617_fk_document_id" FOREIGN KEY ("document_id") REFERENCES "document" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "problem_paragraph_mapping_dataset_id_76ffcb8c" ON "problem_paragraph_mapping" ("dataset_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "problem_paragraph_mapping_document_id_74b9f617" ON "problem_paragraph_mapping" ("document_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "problem_paragraph_mapping_paragraph_id_f0be2e98" ON "problem_paragraph_mapping" ("paragraph_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "problem_paragraph_mapping_problem_id_937b9858" ON "problem_paragraph_mapping" ("problem_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "application" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(128) NOT NULL, "desc" varchar(512) NOT NULL, "prologue" varchar(1024) NOT NULL, "dialogue_number" integer NOT NULL, "dataset_setting" jsonb NOT NULL, "model_setting" jsonb NOT NULL, "problem_optimization" boolean NOT NULL, "model_id" uuid NULL, "user_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "application_chat" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "abstract" varchar(256) NOT NULL, "application_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "application_access_token" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "application_id" uuid NOT NULL PRIMARY KEY, "access_token" varchar(128) NOT NULL UNIQUE, "is_active" boolean NOT NULL, "access_num" integer NOT NULL, "white_active" boolean NOT NULL, "white_list" varchar(128)[] NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "application_chat_record" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "vote_status" varchar(10) NOT NULL, "problem_text" varchar(1024) NOT NULL, "answer_text" varchar(4096) NOT NULL, "message_tokens" integer NOT NULL, "answer_tokens" integer NOT NULL, "const" integer NOT NULL, "details" jsonb NOT NULL, "improve_paragraph_id_list" uuid[] NOT NULL, "run_time" double precision NOT NULL, "index" integer NOT NULL, "chat_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "application_public_access_client" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "access_num" integer NOT NULL, "intraday_access_num" integer NOT NULL, "application_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "application_dataset_mapping" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "application_id" uuid NOT NULL, "dataset_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE TABLE "application_api_key" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "secret_key" varchar(1024) NOT NULL UNIQUE, "is_active" boolean NOT NULL, "application_id" uuid NOT NULL, "user_id" uuid NOT NULL); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application" ADD CONSTRAINT "application_user_id_e0323977_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_model_id_e80b5b34" ON "application" ("model_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_user_id_e0323977" ON "application" ("user_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_chat" ADD CONSTRAINT "application_chat_application_id_0c9f6b90_fk_application_id" FOREIGN KEY ("application_id") REFERENCES "application" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_chat_application_id_0c9f6b90" ON "application_chat" ("application_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_access_token" ADD CONSTRAINT "application_access_t_application_id_d90b8cec_fk_applicati" FOREIGN KEY ("application_id") REFERENCES "application" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_access_token_access_token_3823531a_like" ON "application_access_token" ("access_token" varchar_pattern_ops); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_chat_record" ADD CONSTRAINT "application_chat_record_chat_id_21aeb7ef_fk_application_chat_id" FOREIGN KEY ("chat_id") REFERENCES "application_chat" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_chat_record_chat_id_21aeb7ef" ON "application_chat_record" ("chat_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_public_access_client" ADD CONSTRAINT "application_public_a_application_id_25d9e34e_fk_applicati" FOREIGN KEY ("application_id") REFERENCES "application" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_public_access_client_application_id_25d9e34e" ON "application_public_access_client" ("application_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_dataset_mapping" ADD CONSTRAINT "application_dataset__application_id_90cafa00_fk_applicati" FOREIGN KEY ("application_id") REFERENCES "application" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_dataset_mapping" ADD CONSTRAINT "application_dataset_mapping_dataset_id_a14a235a_fk_dataset_id" FOREIGN KEY ("dataset_id") REFERENCES "dataset" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_dataset_mapping_application_id_90cafa00" ON "application_dataset_mapping" ("application_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_dataset_mapping_dataset_id_a14a235a" ON "application_dataset_mapping" ("dataset_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_api_key" ADD CONSTRAINT "application_api_key_application_id_376d9a01_fk_application_id" FOREIGN KEY ("application_id") REFERENCES "application" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_api_key" ADD CONSTRAINT "application_api_key_user_id_e9e85f1b_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_api_key_secret_key_fd1b76e9_like" ON "application_api_key" ("secret_key" varchar_pattern_ops); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_api_key_application_id_376d9a01" ON "application_api_key" ("application_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] CREATE INDEX "application_api_key_user_id_e9e85f1b" ON "application_api_key" ("user_id"); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_chat" ADD COLUMN "client_id" uuid NULL; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "icon" varchar(256) DEFAULT '/ui/favicon.ico' NOT NULL; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "icon" DROP DEFAULT; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_access_token" ADD COLUMN "show_source" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_access_token" ALTER COLUMN "show_source" DROP DEFAULT; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_chat" ALTER COLUMN "abstract" TYPE varchar(1024); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_chat_record" ALTER COLUMN "answer_text" TYPE varchar(40960); (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_api_key" ADD COLUMN "allow_cross_domain" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_api_key" ALTER COLUMN "allow_cross_domain" DROP DEFAULT; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_api_key" ADD COLUMN "cross_domain_list" varchar(128)[] DEFAULT '{}' NOT NULL; (params None)
2025-10-21 16:56:53 [schema DEBUG] ALTER TABLE "application_api_key" ALTER COLUMN "cross_domain_list" DROP DEFAULT; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "prologue" TYPE varchar(4096); (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application_chat" ADD COLUMN "is_deleted" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application_chat" ALTER COLUMN "is_deleted" DROP DEFAULT; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "type" varchar(256) DEFAULT 'SIMPLE' NOT NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "type" DROP DEFAULT; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "work_flow" jsonb DEFAULT '{}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "work_flow" DROP DEFAULT; (params None)
2025-10-21 16:56:54 [schema DEBUG] CREATE TABLE "application_work_flow_version" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "work_flow" jsonb NOT NULL, "application_id" uuid NOT NULL); (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application_work_flow_version" ADD CONSTRAINT "application_work_flo_application_id_e1ae17fd_fk_applicati" FOREIGN KEY ("application_id") REFERENCES "application" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:54 [schema DEBUG] CREATE INDEX "application_work_flow_version_application_id_e1ae17fd" ON "application_work_flow_version" ("application_id"); (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "model_params_setting" jsonb DEFAULT '{}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "model_params_setting" DROP DEFAULT; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "stt_model_id" uuid NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "stt_model_enable" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "stt_model_enable" DROP DEFAULT; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "tts_model_id" uuid NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "tts_model_enable" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "tts_model_enable" DROP DEFAULT; (params None)
2025-10-21 16:56:54 [schema DEBUG] CREATE INDEX "application_stt_model_id_10e736db" ON "application" ("stt_model_id"); (params None)
2025-10-21 16:56:54 [schema DEBUG] CREATE INDEX "application_tts_model_id_63215f2e" ON "application" ("tts_model_id"); (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "tts_type" varchar(20) DEFAULT 'BROWSER' NOT NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "tts_type" DROP DEFAULT; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "problem_optimization_prompt" varchar(102400) DEFAULT '()里面是用户问题,根据上下文回答揣测用户问题({question}) 要求: 输出一个补全问题,并且放在<data></data>标签中' NULL; (params None)
2025-10-21 16:56:54 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "problem_optimization_prompt" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_chat_record" ALTER COLUMN "problem_text" TYPE varchar(10240); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "tts_model_params_setting" jsonb DEFAULT '{}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "tts_model_params_setting" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "clean_time" integer DEFAULT 180 NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "clean_time" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_work_flow_version" ADD COLUMN "name" varchar(128) DEFAULT '' NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_work_flow_version" ALTER COLUMN "name" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] 
UPDATE "public".application_work_flow_version
SET "name" =  TO_CHAR(create_time, 'YYYY-MM-DD HH24:MI:SS');
; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_work_flow_version" ADD COLUMN "publish_user_id" uuid NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_work_flow_version" ADD COLUMN "publish_user_name" varchar(128) DEFAULT '' NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_work_flow_version" ALTER COLUMN "publish_user_name" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "file_upload_enable" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "file_upload_enable" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "file_upload_setting" jsonb DEFAULT '{}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "file_upload_setting" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_chat_record" ADD COLUMN "answer_text_list" jsonb[] DEFAULT '{}' NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_chat_record" ALTER COLUMN "answer_text_list" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] 
UPDATE application_chat_record
SET answer_text_list=ARRAY[jsonb_build_object('content',answer_text)]
; (params None)
2025-10-21 16:56:56 [schema DEBUG] 
UPDATE application_chat ac
SET update_time = acr_max.max_update_time
FROM (
    SELECT chat_id, MAX(update_time) AS max_update_time
    FROM application_chat_record
    GROUP BY chat_id
) acr_max
WHERE ac.id = acr_max.chat_id;
; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_public_access_client" ADD COLUMN "client_id" uuid DEFAULT 'e577d544ae5b11f0853a36f307d144b8'::uuid NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_public_access_client" ALTER COLUMN "client_id" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE INDEX "application_client__4de9af_idx" ON "application_public_access_client" ("client_id"); (params None)
2025-10-21 16:56:56 [schema DEBUG] 
UPDATE application_public_access_client
SET client_id="id"
; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "tts_autoplay" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "tts_autoplay" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ADD COLUMN "stt_autosend" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "stt_autosend" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_access_token" ADD COLUMN "language" varchar(10) NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application" ALTER COLUMN "prologue" TYPE varchar(40960); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_chat" ADD COLUMN "asker" jsonb DEFAULT  E'{"user_name": "\\u6e38\\u5ba2"}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "application_chat" ALTER COLUMN "asker" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE TABLE "django_content_type" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "name" varchar(100) NOT NULL, "app_label" varchar(100) NOT NULL, "model" varchar(100) NOT NULL); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_content_type" ADD CONSTRAINT "django_content_type_app_label_model_76bd3d3b_uniq" UNIQUE ("app_label", "model"); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_content_type" ALTER COLUMN "name" DROP NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_content_type" DROP COLUMN "name" CASCADE; (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE TABLE "image" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "image" bytea NOT NULL, "image_name" varchar(256) NOT NULL); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "document" ADD COLUMN "hit_handling_method" varchar(20) DEFAULT 'optimization' NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "document" ALTER COLUMN "hit_handling_method" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "document" ADD COLUMN "directly_return_similarity" double precision DEFAULT 0.9 NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "document" ALTER COLUMN "directly_return_similarity" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] grant execute on function lo_from_bytea to root; (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE TABLE "file" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "file_name" varchar(256) NOT NULL, "loid" integer NOT NULL); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "dataset" ADD COLUMN "embedding_mode_id" uuid DEFAULT '42f63a3d427e11efb3eca8a1595801ab'::uuid NOT NULL CONSTRAINT "dataset_embedding_mode_id_03b88255_fk_model_id" REFERENCES "model"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "dataset_embedding_mode_id_03b88255_fk_model_id" IMMEDIATE; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "dataset" ALTER COLUMN "embedding_mode_id" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE INDEX "dataset_embedding_mode_id_03b88255" ON "dataset" ("embedding_mode_id"); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "paragraph" ALTER COLUMN "content" TYPE varchar(102400); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "file" ADD COLUMN "meta" jsonb DEFAULT '{}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "file" ALTER COLUMN "meta" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "document" ADD COLUMN "status_meta" jsonb DEFAULT '{"state_time": {}}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "document" ALTER COLUMN "status_meta" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "paragraph" ADD COLUMN "status_meta" jsonb DEFAULT '{"state_time": {}}'::jsonb NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "paragraph" ALTER COLUMN "status_meta" DROP DEFAULT; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "document" ALTER COLUMN "status" TYPE varchar(20); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "paragraph" ALTER COLUMN "status" TYPE varchar(20); (params None)
2025-10-21 16:56:56 [schema DEBUG] 
UPDATE "paragraph"
SET status ="replace"("replace"("replace"(status, '2', '3'),'0','3'),'1','2')
; (params None)
2025-10-21 16:56:56 [schema DEBUG] 
UPDATE "document"
SET status ="replace"("replace"("replace"(status, '2', '3'),'0','3'),'1','2')
; (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE TABLE "django_apscheduler_djangojob" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "name" varchar(255) NOT NULL UNIQUE, "next_run_time" timestamp with time zone NOT NULL, "job_state" bytea NOT NULL); (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE TABLE "django_apscheduler_djangojobexecution" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "status" varchar(50) NOT NULL, "run_time" timestamp with time zone NOT NULL, "duration" numeric(15, 2) NULL, "started" numeric(15, 2) NULL, "finished" numeric(15, 2) NULL, "exception" varchar(1000) NULL, "traceback" text NULL, "job_id" integer NOT NULL); (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE INDEX "django_apscheduler_djangojob_name_aad859bf_like" ON "django_apscheduler_djangojob" ("name" varchar_pattern_ops); (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE INDEX "django_apscheduler_djangojob_next_run_time_2f022619" ON "django_apscheduler_djangojob" ("next_run_time"); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojobexecution" ADD CONSTRAINT "django_apscheduler_d_job_id_daf5090a_fk_django_ap" FOREIGN KEY ("job_id") REFERENCES "django_apscheduler_djangojob" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE INDEX "django_apscheduler_djangojobexecution_run_time_16edd96b" ON "django_apscheduler_djangojobexecution" ("run_time"); (params None)
2025-10-21 16:56:56 [schema DEBUG] CREATE INDEX "django_apscheduler_djangojobexecution_job_id_daf5090a" ON "django_apscheduler_djangojobexecution" ("job_id"); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojob" ALTER COLUMN "next_run_time" DROP NOT NULL; (params None)
2025-10-21 16:56:56 [schema DEBUG] SET CONSTRAINTS "django_apscheduler_d_job_id_daf5090a_fk_django_ap" IMMEDIATE; ALTER TABLE "django_apscheduler_djangojobexecution" DROP CONSTRAINT "django_apscheduler_d_job_id_daf5090a_fk_django_ap"; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojob" ALTER COLUMN "id" DROP IDENTITY IF EXISTS; (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojob" ALTER COLUMN "id" TYPE varchar(255) USING "id"::varchar(255); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojobexecution" ALTER COLUMN "job_id" TYPE varchar(255) USING "job_id"::varchar(255); (params None)
2025-10-21 16:56:56 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojobexecution" ADD CONSTRAINT "django_apscheduler_djangojobexecution_job_id_daf5090a_fk" FOREIGN KEY ("job_id") REFERENCES "django_apscheduler_djangojob" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojob" DROP COLUMN "name" CASCADE; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojobexecution" ALTER COLUMN "id" TYPE bigint USING "id"::bigint; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER SEQUENCE IF EXISTS "django_apscheduler_djangojobexecution_id_seq" AS bigint; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojobexecution" DROP COLUMN "started" CASCADE; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_apscheduler_djangojobexecution" ADD CONSTRAINT "unique_job_executions" UNIQUE ("job_id", "run_time"); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE TABLE "django_celery_beat_crontabschedule" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "minute" varchar(64) NOT NULL, "hour" varchar(64) NOT NULL, "day_of_week" varchar(64) NOT NULL, "day_of_month" varchar(64) NOT NULL, "month_of_year" varchar(64) NOT NULL); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE TABLE "django_celery_beat_intervalschedule" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "every" integer NOT NULL, "period" varchar(24) NOT NULL); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE TABLE "django_celery_beat_periodictask" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "name" varchar(200) NOT NULL UNIQUE, "task" varchar(200) NOT NULL, "args" text NOT NULL, "kwargs" text NOT NULL, "queue" varchar(200) NULL, "exchange" varchar(200) NULL, "routing_key" varchar(200) NULL, "expires" timestamp with time zone NULL, "enabled" boolean NOT NULL, "last_run_at" timestamp with time zone NULL, "total_run_count" integer NOT NULL CHECK ("total_run_count" >= 0), "date_changed" timestamp with time zone NOT NULL, "description" text NOT NULL, "crontab_id" integer NULL, "interval_id" integer NULL); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE TABLE "django_celery_beat_periodictasks" ("ident" smallint NOT NULL PRIMARY KEY, "last_update" timestamp with time zone NOT NULL); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD CONSTRAINT "django_celery_beat_p_crontab_id_d3cba168_fk_django_ce" FOREIGN KEY ("crontab_id") REFERENCES "django_celery_beat_crontabschedule" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD CONSTRAINT "django_celery_beat_p_interval_id_a8ca27da_fk_django_ce" FOREIGN KEY ("interval_id") REFERENCES "django_celery_beat_intervalschedule" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "django_celery_beat_periodictask_name_265a36b7_like" ON "django_celery_beat_periodictask" ("name" varchar_pattern_ops); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "django_celery_beat_periodictask_crontab_id_d3cba168" ON "django_celery_beat_periodictask" ("crontab_id"); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "django_celery_beat_periodictask_interval_id_a8ca27da" ON "django_celery_beat_periodictask" ("interval_id"); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE TABLE "django_celery_beat_solarschedule" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "event" varchar(24) NOT NULL, "latitude" numeric(9, 6) NOT NULL, "longitude" numeric(9, 6) NOT NULL); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD COLUMN "solar_id" integer NULL CONSTRAINT "django_celery_beat_p_solar_id_a87ce72c_fk_django_ce" REFERENCES "django_celery_beat_solarschedule"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "django_celery_beat_p_solar_id_a87ce72c_fk_django_ce" IMMEDIATE; (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "django_celery_beat_periodictask_solar_id_a87ce72c" ON "django_celery_beat_periodictask" ("solar_id"); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_solarschedule" ADD CONSTRAINT "django_celery_beat_solar_event_latitude_longitude_ba64999a_uniq" UNIQUE ("event", "latitude", "longitude"); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_crontabschedule" ADD COLUMN "timezone" varchar(63) DEFAULT 'UTC' NOT NULL; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_crontabschedule" ALTER COLUMN "timezone" DROP DEFAULT; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_crontabschedule" ALTER COLUMN "day_of_month" TYPE varchar(124); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_crontabschedule" ALTER COLUMN "hour" TYPE varchar(96); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_crontabschedule" ALTER COLUMN "minute" TYPE varchar(240); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD COLUMN "one_off" boolean DEFAULT false NOT NULL; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ALTER COLUMN "one_off" DROP DEFAULT; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD COLUMN "start_time" timestamp with time zone NULL; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD COLUMN "priority" integer NULL CHECK ("priority" >= 0); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD COLUMN "headers" text DEFAULT '{}' NOT NULL; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ALTER COLUMN "headers" DROP DEFAULT; (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE TABLE "django_celery_beat_clockedschedule" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "clocked_time" timestamp with time zone NOT NULL, "enabled" boolean NOT NULL); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD COLUMN "clocked_id" integer NULL CONSTRAINT "django_celery_beat_p_clocked_id_47a69f82_fk_django_ce" REFERENCES "django_celery_beat_clockedschedule"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "django_celery_beat_p_clocked_id_47a69f82_fk_django_ce" IMMEDIATE; (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "django_celery_beat_periodictask_clocked_id_47a69f82" ON "django_celery_beat_periodictask" ("clocked_id"); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_periodictask" ADD COLUMN "expire_seconds" integer NULL CHECK ("expire_seconds" >= 0); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "django_celery_beat_clockedschedule" DROP COLUMN "enabled" CASCADE; (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE TABLE "embedding" ("id" varchar(128) NOT NULL PRIMARY KEY, "source_id" varchar(128) NOT NULL, "source_type" varchar(5) NOT NULL, "is_active" boolean NOT NULL, "embedding" vector NOT NULL, "meta" jsonb NOT NULL, "dataset_id" uuid NOT NULL, "document_id" uuid NOT NULL, "paragraph_id" uuid NOT NULL); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "embedding" ADD CONSTRAINT "embedding_source_id_source_type_065223a0_uniq" UNIQUE ("source_id", "source_type"); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "embedding_id_f61adc5f_like" ON "embedding" ("id" varchar_pattern_ops); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "embedding_dataset_id_bb1b38ca" ON "embedding" ("dataset_id"); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "embedding_document_id_3c89d1f3" ON "embedding" ("document_id"); (params None)
2025-10-21 16:56:57 [schema DEBUG] CREATE INDEX "embedding_paragraph_id_9f39681c" ON "embedding" ("paragraph_id"); (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "embedding" ADD COLUMN "search_vector" tsvector DEFAULT '' NOT NULL; (params None)
2025-10-21 16:56:57 [schema DEBUG] ALTER TABLE "embedding" ALTER COLUMN "search_vector" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "embedding" DROP CONSTRAINT "embedding_source_id_source_type_065223a0_uniq"; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "user" ADD COLUMN "create_time" timestamp with time zone DEFAULT '2025-10-21 08:56:58.054261+00:00'::timestamptz NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "user" ALTER COLUMN "create_time" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "user" ADD COLUMN "update_time" timestamp with time zone DEFAULT '2025-10-21 08:56:58.064661+00:00'::timestamptz NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "user" ALTER COLUMN "update_time" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "user" ADD COLUMN "source" varchar(10) DEFAULT 'LOCAL' NOT NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "user" ALTER COLUMN "source" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "user" ALTER COLUMN "email" DROP NOT NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] CREATE TABLE "function_lib" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "name" varchar(64) NOT NULL, "desc" varchar(128) NOT NULL, "code" varchar(102400) NOT NULL, "input_field_list" jsonb[] NOT NULL, "user_id" uuid NOT NULL); (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ADD CONSTRAINT "function_lib_user_id_99555da0_fk_user_id" FOREIGN KEY ("user_id") REFERENCES "user" ("id") DEFERRABLE INITIALLY DEFERRED; (params None)
2025-10-21 16:56:58 [schema DEBUG] CREATE INDEX "function_lib_user_id_99555da0" ON "function_lib" ("user_id"); (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ADD COLUMN "is_active" boolean DEFAULT true NOT NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ALTER COLUMN "is_active" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ADD COLUMN "permission_type" varchar(20) DEFAULT 'PRIVATE' NOT NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ALTER COLUMN "permission_type" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ADD COLUMN "function_type" varchar(20) DEFAULT 'PUBLIC' NOT NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ALTER COLUMN "function_type" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ADD COLUMN "icon" varchar(256) DEFAULT '/ui/favicon.ico' NOT NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ALTER COLUMN "icon" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ADD COLUMN "init_field_list" jsonb DEFAULT '[]'::jsonb NOT NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ALTER COLUMN "init_field_list" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ADD COLUMN "init_params" varchar(102400) NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "function_lib" ADD COLUMN "template_id" uuid NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] 
INSERT INTO function_lib (create_time, update_time, id, name, "desc", code, input_field_list, user_id, is_active, permission_type, function_type, icon, init_field_list, init_params, template_id) VALUES ('2025-03-10 06:20:35.945414 +00:00', '2025-03-10 09:19:23.608026 +00:00', 'c75cb48e-fd77-11ef-84d2-5618c4394482', '博查搜索', '从博查搜索任何信息和网页URL', e'def bocha_search(query, apikey):
    import requests
    import json
    url = "https://api.bochaai.com/v1/web-search"
    payload = json.dumps({
        "query": query,
        "Boolean": "true",
        "count": 8
    })

    headers = {
        "Authorization": "Bearer " + apikey, #鉴权参数，示例：Bearer xxxxxx，API KEY请先前往博查AI开放平台（https://open.bochaai.com）> API KEY 管理中获取。
        "Content-Type": "application/json"
    }

    response = requests.request("POST", url, headers=headers, data=payload)
    if response.status_code == 200:
        return response.json()
    else:
        raise Exception(f"API请求失败: {response.status_code}, 错误信息: {response.text}")
        return (response.text)', '{"{\"name\": \"query\", \"type\": \"string\", \"source\": \"reference\", \"is_required\": true}"}', 'f0dd8f71-e4ee-11ee-8c84-a8a1595801ab', TRUE, 'PUBLIC', 'INTERNAL', '/ui/fx/bochaai/icon.png', '[{"attrs": {"type": "password", "maxlength": 200, "minlength": 1, "show-password": true, "show-word-limit": true}, "field": "apikey", "label": "API Key", "required": true, "input_type": "PasswordInput", "props_info": {"rules": [{"message": "API Key 为必填属性", "required": true}, {"max": 200, "min": 1, "message": "API Key 长度在 1 到 200 个字符", "trigger": "blur"}]}, "default_value": "x", "show_default_value": false}]', '', NULL);
INSERT INTO function_lib (create_time, update_time, id, name, "desc", code, input_field_list, user_id, is_active, permission_type, function_type, icon, init_field_list, init_params, template_id) VALUES ('2025-02-26 03:36:48.187286 +00:00', '2025-03-11 07:23:46.123972 +00:00', 'e89ad2ae-f3f2-11ef-ad09-0242ac110002', 'Google Search', 'Google Web Search', e'def google_search(query, apikey, cx):
    import requests
    import json
    url = "https://customsearch.googleapis.com/customsearch/v1"
    params = {
        "q": query,
        "key": apikey,
        "cx": cx,
        "num": 10,  # 每次最多返回10条
    }

    response = requests.get(url, params=params)
    if response.status_code == 200:
        return response.json()
    else:
        raise Exception(f"API请求失败: {response.status_code}, 错误信息: {response.text}")
        return (response.text)', '{"{\"name\": \"query\", \"type\": \"string\", \"source\": \"reference\", \"is_required\": true}"}', 'f0dd8f71-e4ee-11ee-8c84-a8a1595801ab', TRUE, 'PUBLIC', 'INTERNAL', '/ui/fx/google_search/icon.png', '[{"attrs": {"type": "password", "maxlength": 200, "minlength": 1, "show-password": true, "show-word-limit": true}, "field": "apikey", "label": "API Key", "required": true, "input_type": "PasswordInput", "props_info": {"rules": [{"message": "API Key 为必填属性", "required": true}, {"max": 200, "min": 1, "message": "API Key 长度在 1 到 200 个字符", "trigger": "blur"}]}, "default_value": "x", "show_default_value": false}, {"attrs": {"maxlength": 200, "minlength": 1, "show-word-limit": true}, "field": "cx", "label": "cx", "required": true, "input_type": "TextInput", "props_info": {"rules": [{"message": "cx 为必填属性", "required": true}, {"max": 200, "min": 1, "message": "cx长度在 1 到 200 个字符", "trigger": "blur"}]}, "default_value": "x", "show_default_value": false}]', '', NULL);
INSERT INTO function_lib (create_time, update_time, id, name, "desc", code, input_field_list, user_id, is_active, permission_type, function_type, icon, init_field_list, init_params, template_id) VALUES ('2025-02-25 07:44:40.141515 +00:00', '2025-03-11 06:33:53.248495 +00:00', '5e912f00-f34c-11ef-8a9c-5618c4394482', 'LangSearch', e'A Web Search tool supporting natural language search
', e'
def langsearch(query, apikey):
    import json
    import requests
    
    url = "https://api.langsearch.com/v1/web-search"
    payload = json.dumps({
        "query": query,
        "summary": True,
        "freshness": "noLimit",
        "livecrawl": True,
        "count": 20
    })
    headers = {
        "Authorization": apikey,
        "Content-Type": "application/json"
    }
    # key从官网申请 https://langsearch.com/
    response = requests.request("POST", url, headers=headers, data=payload)
    if response.status_code == 200:
        return response.json()
    else:
        raise Exception(f"API请求失败: {response.status_code}, 错误信息: {response.text}")
        return (response.text)', '{"{\"name\": \"query\", \"type\": \"string\", \"source\": \"reference\", \"is_required\": true}"}', 'f0dd8f71-e4ee-11ee-8c84-a8a1595801ab', TRUE, 'PUBLIC', 'INTERNAL', '/ui/fx/langsearch/icon.png', '[{"attrs": {"type": "password", "maxlength": 200, "minlength": 1, "show-password": true, "show-word-limit": true}, "field": "apikey", "label": "API Key", "required": true, "input_type": "PasswordInput", "props_info": {"rules": [{"message": "API Key 为必填属性", "required": true}, {"max": 200, "min": 1, "message": "API Key 长度在 1 到 200 个字符", "trigger": "blur"}]}, "default_value": "x", "show_default_value": false}]', '', NULL);
INSERT INTO function_lib (create_time, update_time, id, name, "desc", code, input_field_list, user_id, is_active, permission_type, function_type, icon, init_field_list, init_params, template_id) VALUES ('2025-03-17 08:16:32.626245 +00:00', '2025-03-17 08:16:32.626308 +00:00', '22c21b76-0308-11f0-9694-5618c4394482', 'MySQL 查询', '一个连接MySQL数据库执行SQL查询的工具', e'
def query_mysql(host,port, user, password, database, sql):
    import pymysql
    import json
    from pymysql.cursors import DictCursor

    try:
        # 创建连接
        db = pymysql.connect(
            host=host,
            port=int(port),
            user=user,
            password=password,
            database=database,
            cursorclass=DictCursor  # 使用字典游标
        )

        # 使用 cursor() 方法创建一个游标对象 cursor
        cursor = db.cursor()

        # 使用 execute() 方法执行 SQL 查询
        cursor.execute(sql)

        # 使用 fetchall() 方法获取所有数据
        data = cursor.fetchall()

        # 处理 bytes 类型的数据
        for row in data:
            for key, value in row.items():
                if isinstance(value, bytes):
                    row[key] = value.decode("utf-8")  # 转换为字符串

        # 将数据序列化为 JSON
        json_data = json.dumps(data, ensure_ascii=False)
        return json_data

        # 关闭数据库连接
        db.close()

    except Exception as e:
        print(f"Error while connecting to MySQL: {e}")
        raise e', '{"{\"name\": \"sql\", \"type\": \"string\", \"source\": \"reference\", \"is_required\": true}"}', 'f0dd8f71-e4ee-11ee-8c84-a8a1595801ab', true, 'PUBLIC', 'INTERNAL', '/ui/fx/mysql/icon.png', '[{"attrs": {"maxlength": 200, "minlength": 1, "show-word-limit": true}, "field": "host", "label": "host", "required": true, "input_type": "TextInput", "props_info": {"rules": [{"message": "host 为必填属性", "required": true}, {"max": 200, "min": 1, "message": "host长度在 1 到 200 个字符", "trigger": "blur"}]}, "default_value": "x", "show_default_value": false}, {"attrs": {"maxlength": 20, "minlength": 1, "show-word-limit": true}, "field": "port", "label": "port", "required": true, "input_type": "TextInput", "props_info": {"rules": [{"message": "port 为必填属性", "required": true}, {"max": 20, "min": 1, "message": "port长度在 1 到 20 个字符", "trigger": "blur"}]}, "default_value": "3306", "show_default_value": false}, {"attrs": {"maxlength": 200, "minlength": 1, "show-word-limit": true}, "field": "user", "label": "user", "required": true, "input_type": "TextInput", "props_info": {"rules": [{"message": "user 为必填属性", "required": true}, {"max": 200, "min": 1, "message": "user长度在 1 到 200 个字符", "trigger": "blur"}]}, "default_value": "root", "show_default_value": false}, {"attrs": {"type": "password", "maxlength": 200, "minlength": 1, "show-password": true, "show-word-limit": true}, "field": "password", "label": "password", "required": true, "input_type": "PasswordInput", "props_info": {"rules": [{"message": "password 为必填属性", "required": true}, {"max": 200, "min": 1, "message": "password长度在 1 到 200 个字符", "trigger": "blur"}]}, "default_value": "x", "show_default_value": false}, {"attrs": {"maxlength": 200, "minlength": 1, "show-word-limit": true}, "field": "database", "label": "database", "required": true, "input_type": "TextInput", "props_info": {"rules": [{"message": "database 为必填属性", "required": true}, {"max": 200, "min": 1, "message": "database长度在 1 到 200 个字符", "trigger": "blur"}]}, "default_value": "x", "show_default_value": false}]', null, null);
INSERT INTO function_lib (create_time, update_time, id, name, "desc", code, input_field_list, user_id, is_active, permission_type, function_type, icon, init_field_list, init_params, template_id) VALUES ('2025-03-17 07:37:54.620836 +00:00', '2025-03-17 07:37:54.620887 +00:00', 'bd1e8b88-0302-11f0-87bb-5618c4394482', 'PostgreSQL 查询', '一个连接PostgreSQL数据库执行SQL查询的工具', e'
def queryPgSQL(database, user, password, host, port, query):
    import psycopg2
    import json
    from datetime import datetime

    # 自定义 JSON 序列化函数
    def default_serializer(obj):
        if isinstance(obj, datetime):
            return obj.isoformat()  # 将 datetime 转换为 ISO 格式字符串
        raise TypeError(f"Type {type(obj)} not serializable")

    # 数据库连接信息
    conn_params = {
        "dbname": database,
        "user": user,
        "password": password,
        "host": host,
        "port": port
    }
    try:
        # 建立连接
        conn = psycopg2.connect(**conn_params)
        print("连接成功！")
        # 创建游标对象
        cursor = conn.cursor()
        # 执行查询语句
        cursor.execute(query)
        # 获取查询结果
        rows = cursor.fetchall()
        # 处理 bytes 类型的数据
        columns = [desc[0] for desc in cursor.description]
        result = [dict(zip(columns, row)) for row in rows]
        # 转换为 JSON 格式
        json_result = json.dumps(result, default=default_serializer, ensure_ascii=False)
        return json_result
    except Exception as e:
        print(f"发生错误：{e}")
        raise e
    finally:
        # 关闭游标和连接
        if cursor:
            cursor.close()
        if conn:
            conn.close()', '{"{\"name\": \"query\", \"type\": \"string\", \"source\": \"reference\", \"is_required\": true}"}', 'f0dd8f71-e4ee-11ee-8c84-a8a1595801ab', true, 'PUBLIC', 'INTERNAL', '/ui/fx/postgresql/icon.png', '[{"attrs":{"maxlength":200,"minlength":1,"show-word-limit":true},"field":"host","label":"host","required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"host 为必填属性","required":true},{"max":200,"min":1,"message":"host长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"x","show_default_value":false},{"attrs":{"maxlength":20,"minlength":1,"show-word-limit":true},"field":"port","label":"port","required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"port 为必填属性","required":true},{"max":20,"min":1,"message":"port长度在 1 到 20 个字符","trigger":"blur"}]},"default_value":"5432","show_default_value":false},{"attrs":{"maxlength":200,"minlength":1,"show-word-limit":true},"field":"user","label":"user","required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"user 为必填属性","required":true},{"max":200,"min":1,"message":"user长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"root","show_default_value":false},{"attrs":{"type":"password","maxlength":200,"minlength":1,"show-password":true,"show-word-limit":true},"field":"password","label":"password","required":true,"input_type":"PasswordInput","props_info":{"rules":[{"message":"password 为必填属性","required":true},{"max":200,"min":1,"message":"password长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"x","show_default_value":false},{"attrs":{"maxlength":200,"minlength":1,"show-word-limit":true},"field":"database","label":"database","required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"database 为必填属性","required":true},{"max":200,"min":1,"message":"database长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"x","show_default_value":false}]', null, null);

; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "model" ADD COLUMN "model_params_form" jsonb DEFAULT '[]'::jsonb NOT NULL; (params None)
2025-10-21 16:56:58 [schema DEBUG] ALTER TABLE "model" ALTER COLUMN "model_params_form" DROP DEFAULT; (params None)
2025-10-21 16:56:58 [schema DEBUG] CREATE TABLE "setting_modelparam" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "label" varchar(128) NOT NULL, "field" varchar(256) NOT NULL, "default_value" varchar(1000) NOT NULL, "input_type" varchar(32) NOT NULL, "attrs" jsonb NOT NULL, "required" boolean NOT NULL); (params None)
2025-10-21 16:56:58 [schema DEBUG] 
UPDATE "public"."model" 
SET "model_params_form" = '[{"attrs": {"max": 1, "min": 0.1, "step": 0.01, "precision": 2, "show-input": true, "show-input-controls": false}, "field": "temperature", "label": {"attrs": {"tooltip": "较高的数值会使输出更加随机，而较低的数值会使其更加集中和确定"}, "label": "温度", "input_type": "TooltipLabel", "props_info": {}}, "required": true, "input_type": "Slider", "props_info": {}, "trigger_type": "OPTION_LIST", "default_value": 0.5, "relation_show_field_dict": {}, "relation_trigger_field_dict": {}}, {"attrs": {"max": 100000, "min": 1, "step": 1, "precision": 0, "show-input": true, "show-input-controls": false}, "field": "max_tokens", "label": {"attrs": {"tooltip": "指定模型可生成的最大token个数"}, "label": "输出最大Tokens", "input_type": "TooltipLabel", "props_info": {}}, "required": true, "input_type": "Slider", "props_info": {}, "trigger_type": "OPTION_LIST", "default_value": 4096, "relation_show_field_dict": {}, "relation_trigger_field_dict": {}}]'
WHERE jsonb_array_length(model_params_form)=0
; (params None)
2025-10-21 16:56:58 [schema DEBUG] CREATE TABLE "log" ("create_time" timestamp with time zone NOT NULL, "update_time" timestamp with time zone NOT NULL, "id" uuid NOT NULL PRIMARY KEY, "menu" varchar(128) NOT NULL, "operate" varchar(128) NOT NULL, "operation_object" jsonb NOT NULL, "user" jsonb NOT NULL, "status" integer NOT NULL, "ip_address" varchar(128) NOT NULL, "details" jsonb NOT NULL); (params None)
2025-10-21 16:57:00 [schema DEBUG] ALTER TABLE "user" ADD COLUMN "language" varchar(10) NULL; (params None)
2025-10-21 16:57:14 [log WARNING] Unauthorized: /api/user
